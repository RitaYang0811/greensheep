import{a as C}from"./adArticlesStore-CQWk2-f5.js";import{_ as U,m as G,a as j,c as r,b as e,f as b,v as I,B as p,l as d,F as u,t as f,h as a,k as w,d as S,w as L,r as V,o,V as k,e as B}from"./index-BONkIGd3.js";import"./dateToUnix-DUte0kxx.js";const D={data(){return{isSelectPinnedArticle:!1,selectedPinnedArticle:[],articlesCurrentPage:1,keyword:"",isList:!1,isLoading:!1}},methods:{...G(C,["getArticles","articleActivity","changeTab","getCurrentPageArticles","updateCurrentPage"]),async updatePinnedArticle(){try{this.isSelectPinnedArticle=!1,this.isLoading=!0;const n="https://ec-course-api.hexschool.io/v2/api/greensheep/admin/article",P=this.pinnedArticles.filter(l=>!this.selectedPinnedArticle.includes(l)).map(l=>this.$http.get(`${n}/${l}`)),t=(await Promise.all(P)).map(l=>{var g,h,m;const _=(h=(g=l==null?void 0:l.data)==null?void 0:g.article)==null?void 0:h.id,y={...(m=l==null?void 0:l.data)==null?void 0:m.article,isPinned:!1};return this.$http.put(`${n}/${_}`,{data:y})}),v=await Promise.all(t),A=this.selectedPinnedArticle.filter(l=>!this.pinnedArticles.includes(l)).map(l=>this.$http.get(`${n}/${l}`)),c=(await Promise.all(A)).map(l=>{var g,h,m;const _=(h=(g=l==null?void 0:l.data)==null?void 0:g.article)==null?void 0:h.id,y={...(m=l==null?void 0:l.data)==null?void 0:m.article,isPinned:!0};return this.$http.put(`${n}/${_}`,{data:y})}),Ee=await Promise.all(c);alert("置頂文章已更新"),this.getArticles()}catch(n){alert(n.response.data.message)}finally{this.isLoading=!1}}},watch:{pinnedArticles(){this.selectedPinnedArticle=[...this.pinnedArticles]},keyword(){this.getCurrentPageArticles(1,this.keyword)},articlesCurrentPage(){this.updateCurrentPage(this.articlesCurrentPage)},currentPage(){this.articlesCurrentPage=this.currentPage}},computed:{...j(C,["loadingStatus","searchArticles","currentTab","pinnedArticles","currentPage","currentPageArticles"])},mounted(){this.getArticles()}},F={class:"ad-article"},N=e("h1",{class:"fs-3 mb-4 fw-bold"},"文章管理",-1),M={class:"position-relative"},z=e("i",{class:"bi bi-search float-end fs-5 text-primary pe-2 mt-2 position-absolute top-0 end-0"},null,-1),E={class:"nav border-bottom border-primary mb-4"},q={class:"nav-item"},H={class:"nav-item"},J={class:"d-flex gap-2 gap-md-4 justify-content-between align-items-center mb-4"},K={class:"d-flex gap-2 gap-md-4 align-items-center"},O={class:"d-none d-md-flex gap-4"},Q=e("p",{class:"text-danger fs-8"},"*最多可選擇 3 篇文章",-1),R={class:"d-flex gap-2 gap-md-4"},W=e("i",{class:"bi bi-ui-checks fs-5"},null,-1),X=[W],Y=e("i",{class:"bi bi-ui-checks-grid fs-5"},null,-1),Z=[Y],$={key:0,class:"d-md-none d-flex gap-4 mb-4"},ee=e("p",{class:"text-danger fs-8"},"*最多可選擇 3 篇文章",-1),te={key:0,class:"row row-cols-1 row-cols-sm-2 row-cols-lg-5 mb-10 mb-lg-15 ps-0 list-unstyled",style:{"row-gap":"24px"}},se=["for"],ie={key:0,class:"check-box"},ne=["value","id","disabled"],le=["src","alt"],re={class:"card-body d-flex flex-column p-0 px-2 pt-2"},oe={class:"card-title display-6 text-dark pb-2 mb-auto"},de={key:0,class:"float-end bg-primary text-white py-1 px-2 fs-8"},ce={class:"card-foot d-flex justify-content-evenly border-top border-1 border-primary py-2"},ae=["onClick"],pe=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),ue=[pe],ge=["onClick"],he=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),me=[he],be={key:1,class:"d-flex flex-column gap-3 mb-10 mb-lg-15 ps-0 list-unstyled"},fe=["for"],ve={class:"d-flex align-items-center gap-1 gap-sm-4 position-relative",style:{"min-width":"98px"}},Ae={class:"check-box d-md-none"},_e=["value","id","disabled"],ye=["value","id","disabled"],ke=["src","alt"],Pe={class:"d-flex align-items-md-center flex-column flex-md-row flex-grow-1 gap-md-15 gap-lg-30"},xe={class:"d-flex gap-1 flex-grow-1"},Ce={class:"card-title display-6 text-dark flex-grow-1"},we={key:0,class:"align-self-start bg-primary text-white text-nowrap py-1 px-2 rounded-pill fs-9"},Se={class:"d-flex gap-4 gap-md-8 me-md-10"},Le=["onClick"],Ve=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),Te=[Ve],Ue=["onClick"],Ge=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),je=[Ge],Ie={key:2,class:"text-center va-pagination"},Be=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),De=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Fe={key:3,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},Ne=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),Me=[Ne];function ze(n,i,P,T,t,v){const x=V("vue-awesome-paginate"),A=V("VueLoading");return o(),r("div",F,[N,e("div",M,[b(e("input",{class:"form-control mb-4 rounded-3 border border-primary bg-transparent fs-6",type:"text",placeholder:"請輸入要搜尋的文章","onUpdate:modelValue":i[0]||(i[0]=s=>t.keyword=s)},null,512),[[I,t.keyword,void 0,{trim:!0}]]),z]),e("ul",E,[e("li",q,[e("a",{class:p(["nav-link px-6 py-4",{active:n.currentTab==="公開文章"}]),href:"#",onClick:i[1]||(i[1]=d(s=>n.changeTab("公開文章"),["prevent"]))}," 公開文章 ",2)]),e("li",H,[e("a",{class:p(["nav-link px-6 py-4",{active:n.currentTab==="草稿文章"}]),href:"#",onClick:i[2]||(i[2]=d(s=>n.changeTab("草稿文章"),["prevent"]))}," 草稿文章 ",2)])]),e("div",J,[e("div",K,[e("a",{href:"#",class:p(["btn btn-primary",[{disabled:n.loadingStatus.loadingItem},{"d-none":t.isSelectPinnedArticle}]]),onClick:i[3]||(i[3]=d(s=>n.articleActivity("new"),["prevent"]))}," 建立文章 ",2),n.currentTab==="公開文章"?(o(),r(u,{key:0},[t.isSelectPinnedArticle?(o(),r(u,{key:1},[e("a",{href:"#",class:"btn btn-primary",onClick:i[5]||(i[5]=d((...s)=>v.updatePinnedArticle&&v.updatePinnedArticle(...s),["prevent"]))},"儲存置頂文章"),e("a",{href:"#",class:"btn btn-danger",onClick:i[6]||(i[6]=d(s=>{t.selectedPinnedArticle=[...n.pinnedArticles],t.isSelectPinnedArticle=!1},["prevent"]))}," 取消 "),e("div",O,[e("p",null,"已選擇: "+f(t.selectedPinnedArticle.length)+" 篇",1),e("a",{href:"#",class:"text-decoration-underline link-underline-grey9F link-offset-1",onClick:i[7]||(i[7]=d(s=>t.selectedPinnedArticle=[],["prevent"]))}," 清除選擇 "),Q])],64)):(o(),r("a",{key:0,href:"#",class:p(["btn btn-primary",{disabled:n.loadingStatus.loadingItem}]),onClick:i[4]||(i[4]=d(s=>t.isSelectPinnedArticle=!0,["prevent"]))}," 置頂文章管理 ",2))],64)):a("",!0)]),e("div",R,[e("a",{href:"#",class:p(["btn border border-1 border-primary btn-md text-primary p-2 rounded-3",[{"bg-primary":t.isList},{"text-white":t.isList}]]),onClick:i[8]||(i[8]=d(s=>t.isList=!0,["prevent"]))},X,2),e("a",{href:"#",class:p(["btn border border-1 border-primary btn-md text-primary p-2 rounded-3",[{"bg-primary":!t.isList},{"text-white":!t.isList}]]),onClick:i[9]||(i[9]=d(s=>t.isList=!1,["prevent"]))},Z,2)])]),t.isSelectPinnedArticle?(o(),r("div",$,[e("p",null,"已選擇: "+f(t.selectedPinnedArticle.length)+" 篇",1),e("a",{href:"#",class:"text-decoration-underline link-underline-grey9F link-offset-1",onClick:i[10]||(i[10]=d(s=>t.selectedPinnedArticle=[],["prevent"]))}," 清除選擇 "),ee])):a("",!0),n.loadingStatus.loadingItem?a("",!0):(o(),r(u,{key:1},[t.isList?a("",!0):(o(),r("ul",te,[(o(!0),r(u,null,w(n.currentPageArticles,s=>(o(),r("li",{class:"col",key:s.id},[e("label",{class:"card h-100 border border-1 border-primary position-relative",for:s.id},[t.isSelectPinnedArticle?(o(),r("span",ie,[b(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[11]||(i[11]=c=>t.selectedPinnedArticle=c),value:s.id,id:s.id,disabled:t.selectedPinnedArticle.length>=3&&!t.selectedPinnedArticle.includes(s.id)},null,8,ne),[[k,t.selectedPinnedArticle]])])):a("",!0),e("img",{src:s.image,class:"card-img-top w-100 object-fit-cover",alt:s.title,style:{height:"200px"}},null,8,le),e("div",re,[e("h5",oe,[s.isPinned?(o(),r("span",de,"置頂")):a("",!0),B(f(s.title),1)]),e("div",ce,[e("a",{href:"#",class:p({"disabled-link":n.loadingStatus.loadingDelete||t.isSelectPinnedArticle}),onClick:d(c=>n.articleActivity("edit",s.id),["prevent"])},ue,10,ae),e("a",{href:"#",class:p({"disabled-link":t.isSelectPinnedArticle}),onClick:d(c=>n.articleActivity("delete",s.id),["prevent"])},me,10,ge)])])],8,se)]))),128))])),t.isList?(o(),r("ul",be,[(o(!0),r(u,null,w(n.currentPageArticles,s=>(o(),r("li",{key:s.id,class:"bg-white rounded-3"},[e("label",{for:s.id,class:"d-flex gap-3 gap-md-8 px-2 py-4 px-sm-4"},[e("div",ve,[t.isSelectPinnedArticle?(o(),r(u,{key:0},[e("div",Ae,[b(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[12]||(i[12]=c=>t.selectedPinnedArticle=c),value:s.id,id:s.id,disabled:t.selectedPinnedArticle.length>=3&&!t.selectedPinnedArticle.includes(s.id)},null,8,_e),[[k,t.selectedPinnedArticle]])]),b(e("input",{class:"form-check-input d-none d-md-block",type:"checkbox","onUpdate:modelValue":i[13]||(i[13]=c=>t.selectedPinnedArticle=c),value:s.id,id:s.id,disabled:t.selectedPinnedArticle.length>=3&&!t.selectedPinnedArticle.includes(s.id)},null,8,ye),[[k,t.selectedPinnedArticle]])],64)):a("",!0),e("img",{src:s.image,class:"rounded object-fit-cover",alt:s.title,style:{height:"98px",width:"98px"}},null,8,ke)]),e("div",Pe,[e("div",xe,[e("h5",Ce,f(s.title),1),s.isPinned?(o(),r("p",we,"置頂")):a("",!0)]),e("div",Se,[e("a",{href:"#",class:p({"disabled-link":n.loadingStatus.loadingDelete||t.isSelectPinnedArticle}),onClick:d(c=>n.articleActivity("edit",s.id),["prevent"])},Te,10,Le),e("a",{href:"#",class:p(["",{"disabled-link":t.isSelectPinnedArticle}]),onClick:d(c=>n.articleActivity("delete",s.id),["prevent"])},je,10,Ue)])])],8,fe)]))),128))])):a("",!0)],64)),!n.loadingStatus.loadingItem&&n.searchArticles.length?(o(),r("div",Ie,[S(x,{"total-items":n.searchArticles.length,"items-per-page":10,"max-pages-shown":3,modelValue:t.articlesCurrentPage,"onUpdate:modelValue":i[14]||(i[14]=s=>t.articlesCurrentPage=s),onClick:n.getCurrentPageArticles,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":L(()=>[Be]),"next-button":L(()=>[De]),_:1},8,["total-items","modelValue","onClick"])])):a("",!0),n.loadingStatus.loadingItem?(o(),r("div",Fe,Me)):a("",!0),S(A,{active:t.isLoading},null,8,["active"])])}const Ke=U(D,[["render",ze]]);export{Ke as default};
