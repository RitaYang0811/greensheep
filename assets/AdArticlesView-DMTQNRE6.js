import{a as x}from"./adArticlesStore-BuT5yUWZ.js";import{_ as I,m as T,a as U,c as r,b as e,g as m,v as E,u as a,f as d,F as p,t as f,i as c,r as C,d as w,w as S,j as L,o,P,e as D}from"./index-D6h748qN.js";import{a as j,t as G}from"./sweetalertToast-DGLfW-h-.js";import"./dateToUnix-DUte0kxx.js";import"./scrollToTop-BdmBcgwt.js";import"./sweetalert2.all-V3kJyn40.js";var M={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"greensheep",BASE_URL:"/greensheep/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:N,VITE_APP_API_NAME:R}=M,B={data(){return{isSelectPinnedArticle:!1,selectedPinnedArticle:[],articlesCurrentPage:1,keyword:"",isList:!1,isLoading:!1}},methods:{...T(x,["getArticles","articleActivity","changeTab","getCurrentPageArticles","updateCurrentPage"]),async updatePinnedArticle(){try{this.isSelectPinnedArticle=!1,this.isLoading=!0;const l=`${N}/api/${R}/admin/article`,y=this.pinnedArticles.filter(n=>!this.selectedPinnedArticle.includes(n)).map(n=>this.$http.get(`${l}/${n}`)),t=(await Promise.all(y)).map(n=>{var u,g,h;const v=(g=(u=n==null?void 0:n.data)==null?void 0:u.article)==null?void 0:g.id,A={...(h=n==null?void 0:n.data)==null?void 0:h.article,isPinned:!1};return this.$http.put(`${l}/${v}`,{data:A})});await Promise.all(t);const _=this.selectedPinnedArticle.filter(n=>!this.pinnedArticles.includes(n)).map(n=>this.$http.get(`${l}/${n}`)),s=(await Promise.all(_)).map(n=>{var u,g,h;const v=(g=(u=n==null?void 0:n.data)==null?void 0:u.article)==null?void 0:g.id,A={...(h=n==null?void 0:n.data)==null?void 0:h.article,isPinned:!0};return this.$http.put(`${l}/${v}`,{data:A})});await Promise.all(s),j("已更新置頂文章"),this.getArticles()}catch(l){G(l.response.data.message)}finally{this.isLoading=!1}}},watch:{pinnedArticles(){this.selectedPinnedArticle=[...this.pinnedArticles]},keyword(){this.articlesCurrentPage=1,this.getCurrentPageArticles(this.articlesCurrentPage,this.keyword)},articlesCurrentPage(){this.updateCurrentPage(this.articlesCurrentPage)},currentPage(){this.articlesCurrentPage=this.currentPage}},computed:{...U(x,["loadingStatus","searchArticles","currentTab","pinnedArticles","currentPage","currentPageArticles"])},mounted(){this.getArticles()}},F={class:"ad-article"},O=e("h1",{class:"fs-3 mb-4 fw-bold"},"文章管理",-1),z={class:"position-relative"},q=e("i",{class:"bi bi-search float-end fs-5 text-primary pe-2 mt-2 position-absolute top-0 end-0"},null,-1),H={class:"nav border-bottom border-primary mb-4"},J={class:"nav-item"},K={class:"nav-item"},Q={class:"d-flex gap-2 gap-md-4 justify-content-between align-items-center mb-4"},W={class:"d-flex gap-2 gap-md-4 align-items-center"},X={class:"d-none d-md-flex gap-4"},Y=e("p",{class:"text-danger fs-8"},"*最多可選擇 3 篇文章",-1),Z={class:"d-flex gap-2 gap-md-4"},$=e("i",{class:"bi bi-ui-checks fs-5"},null,-1),ee=[$],te=e("i",{class:"bi bi-ui-checks-grid fs-5"},null,-1),se=[te],ie={key:0,class:"d-md-none d-flex gap-4 mb-4"},ne=e("p",{class:"text-danger fs-8"},"*最多可選擇 3 篇文章",-1),le={key:0,class:"row row-cols-1 row-cols-sm-2 row-cols-lg-5 mb-10 mb-lg-15 ps-0 list-unstyled",style:{"row-gap":"12px"}},re=["for"],oe={key:0,class:"check-box"},de=["value","id","disabled"],ce=["src","alt"],ae={class:"card-body d-flex flex-column p-0 px-2 pt-2"},pe={class:"card-title display-6 text-dark pb-2 mb-auto"},ue={key:0,class:"float-end bg-primary text-white py-1 px-2 ms-1 fs-8"},ge={class:"card-foot d-flex justify-content-evenly border-top border-1 border-primary py-2"},he=["onClick"],me=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),fe=[me],be=["onClick"],_e=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),ve=[_e],Ae={key:1,class:"d-flex flex-column gap-3 mb-10 mb-lg-15 ps-0 list-unstyled"},Pe=["for"],ye={class:"d-flex align-items-center gap-1 gap-sm-4 position-relative",style:{"min-width":"98px"}},ke={class:"check-box d-md-none"},xe=["value","id","disabled"],Ce=["value","id","disabled"],we=["src","alt"],Se={class:"d-flex align-items-md-center flex-column flex-md-row flex-grow-1 gap-md-15 gap-lg-30"},Le={class:"d-flex gap-1 flex-grow-1"},Ve={class:"card-title display-6 text-dark flex-grow-1"},Ie={key:0,class:"align-self-start bg-primary text-white text-nowrap py-1 px-2 rounded-pill fs-9"},Te={class:"d-flex gap-4 gap-md-8 me-md-10"},Ue=["onClick"],Ee=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),De=[Ee],je=["onClick"],Ge=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),Me=[Ge],Ne={key:2,class:"text-center va-pagination"},Re=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Be=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Fe={key:3,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},Oe=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),ze=[Oe];function qe(l,i,y,V,t,b){const _=L("vue-awesome-paginate"),k=L("VueLoading");return o(),r("div",F,[O,e("div",z,[m(e("input",{class:"form-control mb-4 rounded-3 border border-primary bg-transparent fs-6",type:"text",placeholder:"請輸入要搜尋的文章","onUpdate:modelValue":i[0]||(i[0]=s=>t.keyword=s)},null,512),[[E,t.keyword,void 0,{trim:!0}]]),q]),e("ul",H,[e("li",J,[e("a",{class:a(["nav-link px-6 py-4",{active:l.currentTab==="公開文章"}]),href:"#",onClick:i[1]||(i[1]=d(s=>l.changeTab("公開文章"),["prevent"]))}," 公開文章 ",2)]),e("li",K,[e("a",{class:a(["nav-link px-6 py-4",{active:l.currentTab==="草稿文章"}]),href:"#",onClick:i[2]||(i[2]=d(s=>l.changeTab("草稿文章"),["prevent"]))}," 草稿文章 ",2)])]),e("div",Q,[e("div",W,[e("a",{href:"#",class:a(["btn btn-primary",[{disabled:l.loadingStatus.loadingItem},{"d-none":t.isSelectPinnedArticle}]]),onClick:i[3]||(i[3]=d(s=>l.articleActivity("new"),["prevent"]))}," 建立文章 ",2),l.currentTab==="公開文章"?(o(),r(p,{key:0},[t.isSelectPinnedArticle?(o(),r(p,{key:1},[e("a",{href:"#",class:"btn btn-primary",onClick:i[5]||(i[5]=d((...s)=>b.updatePinnedArticle&&b.updatePinnedArticle(...s),["prevent"]))},"儲存置頂文章"),e("a",{href:"#",class:"btn btn-danger",onClick:i[6]||(i[6]=d(s=>(t.selectedPinnedArticle=[...l.pinnedArticles],t.isSelectPinnedArticle=!1),["prevent"]))}," 取消 "),e("div",X,[e("p",null,"已選擇: "+f(t.selectedPinnedArticle.length)+" 篇",1),e("a",{href:"#",class:"text-decoration-underline link-underline-grey9F link-offset-1",onClick:i[7]||(i[7]=d(s=>t.selectedPinnedArticle=[],["prevent"]))}," 清除選擇 "),Y])],64)):(o(),r("a",{key:0,href:"#",class:a(["btn btn-primary",{disabled:l.loadingStatus.loadingItem}]),onClick:i[4]||(i[4]=d(s=>t.isSelectPinnedArticle=!0,["prevent"]))}," 置頂文章管理 ",2))],64)):c("",!0)]),e("div",Z,[e("a",{href:"#",class:a(["btn border border-1 border-primary btn-md text-primary p-2 rounded-3",[{"bg-primary":t.isList},{"text-white":t.isList}]]),onClick:i[8]||(i[8]=d(s=>t.isList=!0,["prevent"]))},ee,2),e("a",{href:"#",class:a(["btn border border-1 border-primary btn-md text-primary p-2 rounded-3",[{"bg-primary":!t.isList},{"text-white":!t.isList}]]),onClick:i[9]||(i[9]=d(s=>t.isList=!1,["prevent"]))},se,2)])]),t.isSelectPinnedArticle?(o(),r("div",ie,[e("p",null,"已選擇: "+f(t.selectedPinnedArticle.length)+" 篇",1),e("a",{href:"#",class:"text-decoration-underline link-underline-grey9F link-offset-1",onClick:i[10]||(i[10]=d(s=>t.selectedPinnedArticle=[],["prevent"]))}," 清除選擇 "),ne])):c("",!0),l.loadingStatus.loadingItem?c("",!0):(o(),r(p,{key:1},[t.isList?c("",!0):(o(),r("ul",le,[(o(!0),r(p,null,C(l.currentPageArticles,s=>(o(),r("li",{class:"col",key:s.id},[e("label",{class:"card h-100 border border-1 border-primary position-relative",for:s.id},[t.isSelectPinnedArticle?(o(),r("span",oe,[m(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[11]||(i[11]=n=>t.selectedPinnedArticle=n),value:s.id,id:s.id,disabled:t.selectedPinnedArticle.length>=3&&!t.selectedPinnedArticle.includes(s.id)},null,8,de),[[P,t.selectedPinnedArticle]])])):c("",!0),e("img",{src:s.image,class:"card-img-top w-100 object-fit-cover",alt:s.title,style:{height:"200px"}},null,8,ce),e("div",ae,[e("h5",pe,[s.isPinned?(o(),r("span",ue,"置頂")):c("",!0),D(f(s.title),1)]),e("div",ge,[e("a",{href:"#",class:a({"disabled-link":l.loadingStatus.loadingDelete||t.isSelectPinnedArticle}),onClick:d(n=>l.articleActivity("edit",s.id),["prevent"])},fe,10,he),e("a",{href:"#",class:a({"disabled-link":t.isSelectPinnedArticle}),onClick:d(n=>l.articleActivity("delete",s.id),["prevent"])},ve,10,be)])])],8,re)]))),128))])),t.isList?(o(),r("ul",Ae,[(o(!0),r(p,null,C(l.currentPageArticles,s=>(o(),r("li",{key:s.id,class:"bg-white rounded-3"},[e("label",{for:s.id,class:"d-flex gap-3 gap-md-8 px-2 py-4 px-sm-4"},[e("div",ye,[t.isSelectPinnedArticle?(o(),r(p,{key:0},[e("div",ke,[m(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[12]||(i[12]=n=>t.selectedPinnedArticle=n),value:s.id,id:s.id,disabled:t.selectedPinnedArticle.length>=3&&!t.selectedPinnedArticle.includes(s.id)},null,8,xe),[[P,t.selectedPinnedArticle]])]),m(e("input",{class:"form-check-input d-none d-md-block",type:"checkbox","onUpdate:modelValue":i[13]||(i[13]=n=>t.selectedPinnedArticle=n),value:s.id,id:s.id,disabled:t.selectedPinnedArticle.length>=3&&!t.selectedPinnedArticle.includes(s.id)},null,8,Ce),[[P,t.selectedPinnedArticle]])],64)):c("",!0),e("img",{src:s.image,class:"rounded object-fit-cover",alt:s.title,style:{height:"98px",width:"98px"}},null,8,we)]),e("div",Se,[e("div",Le,[e("h5",Ve,f(s.title),1),s.isPinned?(o(),r("p",Ie," 置頂 ")):c("",!0)]),e("div",Te,[e("a",{href:"#",class:a({"disabled-link":l.loadingStatus.loadingDelete||t.isSelectPinnedArticle}),onClick:d(n=>l.articleActivity("edit",s.id),["prevent"])},De,10,Ue),e("a",{href:"#",class:a(["",{"disabled-link":t.isSelectPinnedArticle}]),onClick:d(n=>l.articleActivity("delete",s.id),["prevent"])},Me,10,je)])])],8,Pe)]))),128))])):c("",!0)],64)),!l.loadingStatus.loadingItem&&l.searchArticles.length?(o(),r("div",Ne,[w(_,{"total-items":l.searchArticles.length,"items-per-page":10,"max-pages-shown":3,modelValue:t.articlesCurrentPage,"onUpdate:modelValue":i[14]||(i[14]=s=>t.articlesCurrentPage=s),onClick:l.getCurrentPageArticles,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":S(()=>[Re]),"next-button":S(()=>[Be]),_:1},8,["total-items","modelValue","onClick"])])):c("",!0),l.loadingStatus.loadingItem?(o(),r("div",Fe,ze)):c("",!0),w(k,{active:t.isLoading},null,8,["active"])])}const Ye=I(B,[["render",qe]]);export{Ye as default};
