import{M as z}from"./modal-D5JZlM1m.js";import{Y as A,_ as F,o as a,c as d,b as e,x as k,w as v,f as C,d as u,n as _,g as U,B as N,F as y,e as r,i as p,r as K,t as h,j as x,p as q,k as j,m as Y}from"./index-C7ZCXOHW.js";import{c as W}from"./copyTextStore-DTdNmwXt.js";import{d as D}from"./dateToUnix-DUte0kxx.js";import{t as V,a as L}from"./sweetalertToast-Byd4FdsM.js";import{s as H}from"./scrollToTop-BdmBcgwt.js";import"./selector-engine-CcKBiot-.js";import"./sweetalert2.all-BfZHEHzJ.js";function I(o){const s=o.getFullYear(),c=(o.getMonth()+1).toString().padStart(2,"0"),m=o.getDate().toString().padStart(2,"0");return`${s}-${c}-${m}`}function R(o){const s=new Date(o);return I(s)}A("compareWithDiscount",(o,[s])=>typeof o=="number"&&typeof s=="number"?o>=s?!0:"折抵金額不可大於訂單金額":!0);A("compareWithPrice",(o,[s])=>typeof o=="number"&&typeof s=="number"?o<=s?!0:"折抵金額不可大於訂單金額":!0);const O={props:["coupon","isNew","loadingStatus","newCoupon"],data(){return{modal:"",couponData:"",newCouponData:""}},methods:{reset(){this.$refs.couponForm.resetForm()},openModal(){this.modal.show()},closeModal(){this.modal.hide()},unixToDate(o){const s=o*1e3;return R(s)},format(o){const s=o.map(c=>I(c));return`${s[0]?s[0]:"請選擇日期"} 至 ${s[1]?s[1]:"請選擇日期"}`},blurValidate(){this.$refs.couponForm.validateField("日期")},updateCoupon(){this.isNew?this.$emit("updateCoupon",this.newCouponData):this.$emit("updateCoupon",this.couponData)},resetNewCoupon(){this.newCouponData={...this.newCoupon}},preventKeydownSpecialKey(o){const{key:s}=o;/\d|Backspace|Tab|Control|v/.test(s)||o.preventDefault()},preventPasteSpecialKey(o){const s=o.clipboardData.getData("text");/^\d+$/.test(s)||o.preventDefault()}},watch:{coupon(){this.couponData={...this.coupon},this.couponData.dates=[this.couponData.start_date*1e3,this.couponData.due_date*1e3]}},computed:{discountsOption(){const o=[];for(let s=95;s>5;s-=5){let c="";const m=s;s%10?c=`${s} 折`:c=`${s/10} 折`,o.push([c,m])}return o}},mounted(){this.modal=new z(this.$refs.adCouponCompModal,{backdrop:!0})}},b=o=>(q("data-v-ba992b8d"),o=o(),j(),o),X={class:"modal fade ad-coupon",ref:"adCouponCompModal",role:"dialog"},J={class:"modal-dialog modal-dialog-centered"},Q={class:"modal-header bg-primary py-2 px-3"},Z=b(()=>e("h2",{class:"modal-title fs-5 fw-medium text-white"}," 建立優惠券 ",-1)),$=b(()=>e("i",{class:"bi bi-x-lg text-white"},null,-1)),ee=[$],te={class:"modal-body py-4 px-6"},se={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},oe=b(()=>e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),ne=[oe],le={key:1,class:"text-start"},ae={class:"mb-3"},ie=b(()=>e("div",{class:"d-flex justify-content-between"},[e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*優惠碼"),e("p",null,"*為必填")],-1)),de={class:"mb-3"},ce=b(()=>e("p",{class:"mb-3 fs-6"},"*優惠方式",-1)),ue={class:"form-check mb-3"},re=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault1"}," 訂單金額折抵 ",-1)),pe={class:"d-flex flex-column gap-2 mb-3"},_e={class:"fs-8"},me={class:"fs-8"},he={class:"form-check"},be=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault2"}," 訂單折扣 ",-1)),ge={class:"d-flex flex-column gap-2"},fe={class:"fs-8"},ye={class:"fs-8"},ve=b(()=>e("option",{value:""},"請選擇折扣",-1)),Ce=["value"],xe={class:"mb-3"},we=b(()=>e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*開始 / 結束日期",-1)),ke={class:"modal-footer py-4 px-6"},De=["disabled"],Ve=["disabled"],Pe={class:"modal-header bg-primary py-2 px-3"},Te=b(()=>e("h2",{class:"modal-title fs-5 fw-medium text-white"}," 編輯優惠券 ",-1)),Se=b(()=>e("i",{class:"bi bi-x-lg text-white"},null,-1)),Me=[Se],Ue={class:"modal-body py-4 px-6"},Ne={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},Ke=b(()=>e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),Be=[Ke],Ge={key:1,class:"text-start"},Ee={class:"mb-3"},Le=b(()=>e("div",{class:"d-flex justify-content-between"},[e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*優惠碼"),e("p",null,"*為必填")],-1)),Fe={class:"mb-3"},Ae=b(()=>e("p",{class:"mb-3 fs-6"},"*優惠方式",-1)),Ie={class:"form-check mb-3"},Re=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault1"}," 訂單金額折抵 ",-1)),ze={class:"d-flex flex-column gap-2 mb-3"},qe={class:"fs-8"},je={class:"fs-8"},Ye={class:"form-check"},We=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault2"}," 訂單折扣 ",-1)),He={class:"d-flex flex-column gap-2"},Oe={class:"fs-8"},Xe={class:"fs-8"},Je=b(()=>e("option",{value:""},"請選擇折扣",-1)),Qe=["value"],Ze={class:"mb-3"},$e=b(()=>e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*開始 / 結束日期",-1)),et={class:"modal-footer py-4 px-6"},tt=["disabled"],st=["disabled"];function ot(o,s,c,m,t,l){const g=x("VField"),f=x("ErrorMessage"),S=x("VueDatePicker"),M=x("VForm");return a(),d("div",X,[e("div",J,[c.isNew?(a(),k(M,{key:0,class:"modal-content custom-form",ref:"couponForm",onSubmit:l.updateCoupon},{default:v(({errors:n,meta:w})=>[e("div",Q,[Z,e("a",{role:"button","aria-label":"Close",onClick:s[0]||(s[0]=C((...i)=>l.closeModal&&l.closeModal(...i),["prevent"]))},ee)]),e("div",te,[c.loadingStatus.loadingGetCoupon?(a(),d("div",se,ne)):(a(),d("div",le,[e("div",ae,[ie,u(g,{type:"text",name:"優惠碼",rules:"required|alpha_num|max:12",class:_(["form-control",{"is-invalid":n.優惠碼}]),id:"couponCode",placeholder:"設定 12 個字元以內的英文字母和數字",modelValue:t.newCouponData.code,"onUpdate:modelValue":s[1]||(s[1]=i=>t.newCouponData.code=i)},null,8,["class","modelValue"]),u(f,{name:"優惠碼",class:"invalid-feedback"})]),e("div",de,[ce,e("div",ue,[U(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault1",value:"金額折抵","onUpdate:modelValue":s[2]||(s[2]=i=>t.newCouponData.title=i)},null,512),[[N,t.newCouponData.title]]),re,e("div",pe,[e("p",_e,[t.newCouponData.title==="金額折抵"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"金額",rules:t.newCouponData.title==="金額折抵"?"required|compareWithDiscount:@折抵金額":"",class:_(["form-control",{"is-invalid":n.金額}]),placeholder:"設定金額",modelValue:t.newCouponData.min_buy_price_by_price,"onUpdate:modelValue":s[3]||(s[3]=i=>t.newCouponData.min_buy_price_by_price=i),modelModifiers:{number:!0},disabled:t.newCouponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),u(f,{name:"金額",class:"invalid-feedback"})]),e("p",me,[t.newCouponData.title==="金額折抵"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("折抵金額 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"折抵金額",rules:t.newCouponData.title==="金額折抵"?"required|compareWithPrice:@金額":"",class:_(["form-control",{"is-invalid":n.折抵金額}]),placeholder:"設定金額",modelValue:t.newCouponData.discount_price,"onUpdate:modelValue":s[4]||(s[4]=i=>t.newCouponData.discount_price=i),modelModifiers:{number:!0},disabled:t.newCouponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),u(f,{name:"折抵金額",class:"invalid-feedback"})])])]),e("div",he,[U(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault2",value:"訂單折扣","onUpdate:modelValue":s[5]||(s[5]=i=>t.newCouponData.title=i)},null,512),[[N,t.newCouponData.title]]),be,e("div",ge,[e("p",fe,[t.newCouponData.title==="訂單折扣"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"消費金額",rules:{required:t.newCouponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.消費金額}]),placeholder:"設定金額",modelValue:t.newCouponData.min_buy_price_by_discount,"onUpdate:modelValue":s[6]||(s[6]=i=>t.newCouponData.min_buy_price_by_discount=i),modelModifiers:{number:!0},disabled:t.newCouponData.title==="金額折抵"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),u(f,{name:"消費金額",class:"invalid-feedback"})]),e("p",ye,[t.newCouponData.title==="訂單折扣"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("折扣 ")]),e("div",null,[u(g,{as:"select",name:"折扣",rules:{required:t.newCouponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.折扣}]),placeholder:"請選擇折扣",modelValue:t.newCouponData.percent,"onUpdate:modelValue":s[7]||(s[7]=i=>t.newCouponData.percent=i),disabled:t.newCouponData.title==="金額折抵"},{default:v(()=>[ve,(a(!0),d(y,null,K(l.discountsOption,i=>(a(),d("option",{key:i[0],value:i[1]},h(i[0]),9,Ce))),128))]),_:2},1032,["rules","class","modelValue","disabled"]),u(f,{name:"折扣",class:"invalid-feedback"})])])])]),e("div",xe,[we,u(g,{name:"日期",modelValue:t.newCouponData.dates,"onUpdate:modelValue":s[9]||(s[9]=i=>t.newCouponData.dates=i),rules:"required"},{default:v(()=>[u(S,{modelValue:t.newCouponData.dates,"onUpdate:modelValue":s[8]||(s[8]=i=>t.newCouponData.dates=i),"input-class-name":"border-0",class:_(["dp-custom form-control py-0 ps-0 pe-9",{"is-invalid":n.日期}]),"model-type":"timestamp",range:{partialRange:!1},format:l.format,"enable-time-picker":!1,locale:"zh-TW",cancelText:"取消",selectText:"選擇",onBlur:l.blurValidate},null,8,["modelValue","class","format","onBlur"])]),_:2},1032,["modelValue"]),u(f,{name:"日期",class:"invalid-feedback"})])]))]),e("div",ke,[e("button",{type:"button",class:"btn btn-outline-primary border-1",disabled:c.loadingStatus.loadingGetCoupon,onClick:s[10]||(s[10]=(...i)=>l.closeModal&&l.closeModal(...i))}," 取消 ",8,De),e("button",{type:"submit",class:"btn btn-primary",disabled:c.loadingStatus.loadingGetCoupon||!w.valid}," 確定 ",8,Ve)])]),_:1},8,["onSubmit"])):(a(),k(M,{key:1,class:"modal-content custom-form",ref:"couponForm",onSubmit:l.updateCoupon},{default:v(({errors:n,meta:w})=>[e("div",Pe,[Te,e("a",{role:"button","aria-label":"Close",onClick:s[11]||(s[11]=C((...i)=>l.closeModal&&l.closeModal(...i),["prevent"]))},Me)]),e("div",Ue,[c.loadingStatus.loadingGetCoupon?(a(),d("div",Ne,Be)):(a(),d("div",Ge,[e("div",Ee,[Le,u(g,{type:"text",name:"優惠碼",rules:"required|alpha_num|max:12",class:_(["form-control",{"is-invalid":n.優惠碼}]),id:"couponCode",placeholder:"設定 12 個字元以內的英文字母和數字",modelValue:t.couponData.code,"onUpdate:modelValue":s[12]||(s[12]=i=>t.couponData.code=i)},null,8,["class","modelValue"]),u(f,{name:"優惠碼",class:"invalid-feedback"})]),e("div",Fe,[Ae,e("div",Ie,[U(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault1",value:"金額折抵","onUpdate:modelValue":s[13]||(s[13]=i=>t.couponData.title=i)},null,512),[[N,t.couponData.title]]),Re,e("div",ze,[e("p",qe,[t.couponData.title==="金額折抵"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"金額",rules:t.couponData.title==="金額折抵"?"required|compareWithDiscount:@折抵金額":"",class:_(["form-control",{"is-invalid":n.金額}]),placeholder:"設定金額",modelValue:t.couponData.min_buy_price_by_price,"onUpdate:modelValue":s[14]||(s[14]=i=>t.couponData.min_buy_price_by_price=i),modelModifiers:{number:!0},disabled:t.couponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),u(f,{name:"金額",class:"invalid-feedback"})]),e("p",je,[t.couponData.title==="金額折抵"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("折抵金額 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"折抵金額",rules:t.couponData.title==="金額折抵"?"required|compareWithPrice:@金額":"",class:_(["form-control",{"is-invalid":n.折抵金額}]),placeholder:"設定金額",modelValue:t.couponData.discount_price,"onUpdate:modelValue":s[15]||(s[15]=i=>t.couponData.discount_price=i),modelModifiers:{number:!0},disabled:t.couponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),u(f,{name:"折抵金額",class:"invalid-feedback"})])])]),e("div",Ye,[U(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault2",value:"訂單折扣","onUpdate:modelValue":s[16]||(s[16]=i=>t.couponData.title=i)},null,512),[[N,t.couponData.title]]),We,e("div",He,[e("p",Oe,[t.couponData.title==="訂單折扣"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"消費金額",rules:{required:t.couponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.消費金額}]),placeholder:"設定金額",modelValue:t.couponData.min_buy_price_by_discount,"onUpdate:modelValue":s[17]||(s[17]=i=>t.couponData.min_buy_price_by_discount=i),modelModifiers:{number:!0},disabled:t.couponData.title==="金額折抵"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),u(f,{name:"消費金額",class:"invalid-feedback"})]),e("p",Xe,[t.couponData.title==="訂單折扣"?(a(),d(y,{key:0},[r("*")],64)):p("",!0),r("折扣 ")]),e("div",null,[u(g,{as:"select",name:"折扣",rules:{required:t.couponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.折扣}]),placeholder:"請選擇折扣",modelValue:t.couponData.percent,"onUpdate:modelValue":s[18]||(s[18]=i=>t.couponData.percent=i),disabled:t.couponData.title==="金額折抵"},{default:v(()=>[Je,(a(!0),d(y,null,K(l.discountsOption,i=>(a(),d("option",{key:i[0],value:i[1]},h(i[0]),9,Qe))),128))]),_:2},1032,["rules","class","modelValue","disabled"]),u(f,{name:"折扣",class:"invalid-feedback"})])])])]),e("div",Ze,[$e,u(g,{name:"日期",modelValue:t.couponData.dates,"onUpdate:modelValue":s[20]||(s[20]=i=>t.couponData.dates=i),rules:"required"},{default:v(()=>[u(S,{modelValue:t.couponData.dates,"onUpdate:modelValue":s[19]||(s[19]=i=>t.couponData.dates=i),"input-class-name":"border-0",class:_(["dp-custom form-control py-0 ps-0 pe-9",{"is-invalid":n.日期}]),"model-type":"timestamp",range:{partialRange:!1},format:l.format,"enable-time-picker":!1,locale:"zh-TW",cancelText:"取消",selectText:"選擇",onBlur:l.blurValidate},null,8,["modelValue","class","format","onBlur"])]),_:2},1032,["modelValue"]),u(f,{name:"日期",class:"invalid-feedback"})])]))]),e("div",et,[e("button",{type:"button",class:"btn btn-outline-primary border-1",disabled:c.loadingStatus.loadingGetCoupon,onClick:s[21]||(s[21]=(...i)=>l.closeModal&&l.closeModal(...i))}," 取消 ",8,tt),e("button",{type:"submit",class:"btn btn-primary",disabled:c.loadingStatus.loadingGetCoupon||!w.valid}," 確定 ",8,st)])]),_:1},8,["onSubmit"]))])],512)}const nt=F(O,[["render",ot],["__scopeId","data-v-ba992b8d"]]),lt={props:["copyContent","type"],methods:{...Y(W,["copyTextMethod"]),copyText(){this.copyTextMethod(this.copyContent,this.type)}}},at=e("i",{class:"bi bi-copy"},null,-1),it=[at];function dt(o,s,c,m,t,l){return a(),d("a",{class:"ms-1",onClick:s[0]||(s[0]=C((...g)=>l.copyText&&l.copyText(...g),["prevent"]))},it)}const ct=F(lt,[["render",dt]]),B="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%23198754'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm-2%2015-5-5%201.41-1.41L10%2014.17l7.59-7.59L19%208l-9%209z'/%3e%3c/svg%3e",G="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%23dc3545'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.47%202%202%206.47%202%2012s4.47%2010%2010%2010%2010-4.47%2010-10S17.53%202%2012%202zm5%2013.59L15.59%2017%2012%2013.41%208.41%2017%207%2015.59%2010.59%2012%207%208.41%208.41%207%2012%2010.59%2015.59%207%2017%208.41%2013.41%2012%2017%2015.59z'/%3e%3c/svg%3e",E="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%239f9f9f'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm5%2011H7v-2h10v2z'/%3e%3c/svg%3e";var ut={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"greensheep",VITE_LINE_CLIENT_ID:"x9iTcS6m9Fdlz8XFfAbkqs",VITE_LINE_CLIENT_SECRET:"iGiOLRLmU2aNTDuObVQlcP5XzPYSbUzJ9gvUl4YvPzx",BASE_URL:"/greensheep/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:P,VITE_APP_API_NAME:T}=ut,rt={data(){return{currentTab:"所有優惠券",currentPageCoupons:[],currentPage:1,coupons:[],validCoupons:[],notYetValidCoupons:[],invalidCoupons:[],coupon:{},newCoupon:{title:"金額折抵"},isNew:!0,isLoading:!1,loadingStatus:{loadingGetCoupons:!1,loadingGetCoupon:!1,loadingDelCoupon:""}}},components:{AdCouponModal:nt,CopyText:ct},methods:{async getCoupons(){try{this.loadingStatus.loadingGetCoupons=!0,this.coupons=[],this.validCoupons=[],this.invalidCoupons=[],this.notYetValidCoupons=[],this.currentPageCoupons=[];let o,s;const c=`${P}/api/${T}/admin/coupons`,m=await this.$http.get(c);for(this.coupons=m.data.coupons,o=m.data.pagination.current_page+1,s=m.data.pagination.total_pages;o<=s;){const t=await this.$http.get(`${c}?page=${o}`);this.coupons=[...this.coupons,...t.data.coupons],o++}this.filterCoupons(),this.changePage(this.currentPage)}catch(o){V(o.response.data.message)}finally{this.loadingStatus.loadingGetCoupons=!1}},filterCoupons(){this.coupons.forEach(o=>{D("now")>o.start_date&&D("now")<o.due_date?this.validCoupons.push(o):D("now")>o.due_date?this.invalidCoupons.push(o):D("now")<o.start_date&&this.notYetValidCoupons.push(o)})},changePage(o){switch(this.currentTab){case"所有優惠券":this.currentPageCoupons=this.coupons.slice((o-1)*10,o*10);break;case"有效":this.currentPageCoupons=this.validCoupons.slice((o-1)*10,o*10);break;case"尚未生效":this.currentPageCoupons=this.notYetValidCoupons.slice((o-1)*10,o*10);break;case"已失效":this.currentPageCoupons=this.invalidCoupons.slice((o-1)*10,o*10);break}H()},changeTab(o){this.currentTab=o,this.currentPage=1,this.changePage(this.currentPage)},async getCoupon(o){try{this.loadingStatus.loadingGetCoupon=!0;const s=`${P}/api/${T}/admin/coupons`,c=await this.$http.get(s);this.coupon=c.data.coupons.find(m=>m.id===o),this.loadingStatus.loadingGetCoupon=!1}catch(s){V(s.response.data.message)}finally{this.loadingStatus.loadingGetCoupon=!1}},updateCoupon(o){this.loadingStatus.loadingGetCoupon=!0;const s={title:o.title,is_enabled:1,percent:o.title==="金額折抵"?100:o.percent,start_date:o.dates[0]/1e3,due_date:o.dates[1]/1e3,code:o.code};if(o.title==="金額折抵"?(s.min_buy_price_by_price=o.min_buy_price_by_price,s.discount_price=o.discount_price,s.min_buy_price_by_discount=""):o.title==="訂單折扣"&&(s.min_buy_price_by_discount=o.min_buy_price_by_discount,s.min_buy_price_by_price="",s.discount_price=""),this.isNew){const c=`${P}/api/${T}/admin/coupon`;this.$http.post(c,{data:s}).then(m=>{L(m.data.message),this.$refs.adCouponModal.closeModal(),this.getCoupons()}).catch(m=>{V(m.response.data.message)}).finally(()=>{this.loadingStatus.loadingGetCoupon=!1})}else if(!this.isNew){const c=o.id,m=`${P}/api/${T}/admin/coupon/${c}`;this.$http.put(m,{data:s}).then(t=>{L(t.data.message),this.$refs.adCouponModal.closeModal(),this.getCoupons()}).catch(t=>{V(t.response.data.message)}).finally(()=>{this.loadingStatus.loadingGetCoupon=!1})}},deleteCoupon(o){this.loadingStatus.loadingDelCoupon=o;const s=`${P}/api/${T}/admin/coupon/${o}`;this.$http.delete(s).then(c=>{L(c.data.message),this.getCoupons()}).catch(c=>{V(c.response.data.message)}).finally(()=>{this.loadingStatus.loadingDelCoupon=""})},async openModal(o,s){switch(o){case"new":this.$refs.adCouponModal.reset(),this.isNew=!0,this.$refs.adCouponModal.resetNewCoupon(),this.$refs.adCouponModal.openModal();break;case"edit":this.isNew=!1,this.$refs.adCouponModal.openModal(),await this.getCoupon(s);break}},unixToDate(o){const s=o*1e3;return R(s)},dateToUnix(o="now"){return D(o)}},mounted(){this.getCoupons()}},pt={class:"ad-coupon px-lg-10 pt-3 pt-lg-10 text-start"},_t=e("h1",{class:"fs-3 mb-4 fw-bold"},"優惠管理",-1),mt={class:"nav flex-nowrap text-nowrap overflow-x-scroll overflow-x-sm-auto border-bottom border-primary mb-4"},ht={class:"nav-item"},bt={class:"nav-item"},gt={class:"nav-item"},ft={class:"nav-item"},yt={class:"table-container table-responsive d-none d-lg-block"},vt={key:0,class:"table align-middle text-nowrap mb-4"},Ct=e("thead",{class:"table-head position-relative"},[e("tr",null,[e("th",{style:{width:"15%"}},"優惠碼"),e("th",{style:{width:"30%"}},"優惠型式"),e("th",{style:{width:"15%"}},"開始日期"),e("th",{style:{width:"15%"}},"結束日期"),e("th",{style:{width:"15%"}},"狀態"),e("th",{style:{width:"5%"}}),e("th",{style:{width:"5%"}})])],-1),xt={class:"py-5"},wt={class:"fw-bold mb-4"},kt={key:0},Dt={key:1},Vt={key:0,class:"text-success"},Pt=e("img",{src:B,alt:"有效",class:"align-top"},null,-1),Tt={key:1,class:"text-danger"},St=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),Mt={key:2},Ut=e("img",{src:E,alt:"已失效",class:"align-top"},null,-1),Nt={key:1,class:"text-success"},Kt=e("img",{src:B,alt:"有效",class:"align-top"},null,-1),Bt={key:2},Gt=e("img",{src:E,alt:"已失效",class:"align-top"},null,-1),Et={key:3,class:"text-danger"},Lt=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),Ft=["onClick"],At=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),It=[At],Rt={class:"d-flex align-items-center"},zt=["onClick"],qt=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),jt=[qt],Yt={key:0,class:"spinner-border spinner-border-sm",role:"status"},Wt=e("span",{class:"visually-hidden"},"Loading...",-1),Ht=[Wt],Ot={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"360px"}},Xt=e("p",{class:"fs-5"},"尚無優惠券資料",-1),Jt=[Xt],Qt={class:"row list-unstyled text-dark d-lg-none",style:{"row-gap":"12px"}},Zt={class:"border border-primary rounded overflow-hidden"},$t={class:"row g-0"},es={class:"col-12"},ts={class:"bg-primary d-flex justify-content-between align-items-center px-2 py-2"},ss={class:"bg-primary text-white fw-bold"},os={class:"text-end bg-white rounded-pill px-2 py-1 fs-8"},ns={key:0,class:"text-success"},ls=e("img",{src:B,alt:"有效",class:"align-top"},null,-1),as={key:1,class:"text-danger"},is=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),ds={key:2},cs=e("img",{src:E,alt:"已失效",class:"align-top"},null,-1),us={key:1,class:"text-success"},rs=e("img",{src:B,alt:"有效",class:"align-top"},null,-1),ps={key:2},_s=e("img",{src:E,alt:"已失效",class:"align-top"},null,-1),ms={key:3,class:"text-danger"},hs=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),bs={class:"col-12"},gs={class:"px-2 py-2 border-bottom border-primary"},fs={class:"fw-bold mb-2"},ys={key:0},vs={key:1},Cs={class:"col-9"},xs={class:"px-2 py-2"},ws={class:"col-3"},ks={class:"d-flex justify-content-between justify-content-sm-evenly pe-4 py-2"},Ds=["onClick"],Vs=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),Ps=[Vs],Ts=["onClick"],Ss=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),Ms={key:0,class:"spinner-border spinner-border-sm",role:"status"},Us=e("span",{class:"visually-hidden"},"Loading...",-1),Ns=[Us],Ks={key:0,class:"text-center va-pagination"},Bs=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Gs=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Es=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Ls=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Fs=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),As=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Is=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Rs=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),zs={key:1,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},qs=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),js=[qs];function Ys(o,s,c,m,t,l){const g=x("CopyText"),f=x("VueAwesomePaginate"),S=x("VueLoading"),M=x("AdCouponModal");return a(),d(y,null,[e("div",pt,[_t,e("ul",mt,[e("li",ht,[e("a",{class:_(["nav-link px-6 py-4",{active:t.currentTab==="所有優惠券"}]),href:"#",onClick:s[0]||(s[0]=C(n=>l.changeTab("所有優惠券"),["prevent"]))}," 所有優惠券 ",2)]),e("li",bt,[e("a",{class:_(["nav-link px-6 py-4",{active:t.currentTab==="有效"}]),href:"#",onClick:s[1]||(s[1]=C(n=>l.changeTab("有效"),["prevent"]))}," 有效 ",2)]),e("li",gt,[e("a",{class:_(["nav-link px-6 py-4",{active:t.currentTab==="尚未生效"}]),href:"#",onClick:s[2]||(s[2]=C(n=>l.changeTab("尚未生效"),["prevent"]))}," 尚未生效 ",2)]),e("li",ft,[e("a",{class:_(["nav-link px-6 py-4",{active:t.currentTab==="已失效"}]),onClick:s[3]||(s[3]=C(n=>l.changeTab("已失效"),["prevent"]))}," 已失效 ",2)])]),e("a",{class:"btn btn-primary mb-4",onClick:s[4]||(s[4]=C(n=>l.openModal("new"),["prevent"]))},"新增優惠券"),e("div",yt,[!t.loadingStatus.loadingGetCoupons&&t.currentPageCoupons.length?(a(),d("table",vt,[Ct,e("tbody",null,[(a(!0),d(y,null,K(t.currentPageCoupons,n=>(a(),d("tr",{key:n.id},[e("td",null,[r(h(n.code)+" ",1),u(g,{copyContent:n.code,type:"優惠碼"},null,8,["copyContent"])]),e("td",xt,[e("p",wt,h(n.title),1),n.title==="金額折抵"?(a(),d("p",kt," 消費滿 NT$ "+h(n.min_buy_price_by_price)+"，享 NT$ "+h(n.discount_price)+" 折扣 ",1)):p("",!0),n.title==="訂單折扣"?(a(),d("p",Dt," 消費滿 NT$ "+h(n.min_buy_price_by_discount)+"，享 "+h(n.percent%10?n.percent:n.percent/10)+" 折 ",1)):p("",!0)]),e("td",null,h(l.unixToDate(n.start_date)),1),e("td",null,h(l.unixToDate(n.due_date)),1),e("td",null,[t.currentTab==="所有優惠券"?(a(),d(y,{key:0},[l.dateToUnix()>n.start_date&&l.dateToUnix()<n.due_date?(a(),d("span",Vt,[r(" 有效 "),Pt])):p("",!0),l.dateToUnix()>n.due_date?(a(),d("span",Tt,[r(" 已失效 "),St])):p("",!0),l.dateToUnix()<n.start_date?(a(),d("span",Mt,[r(" 尚未生效 "),Ut])):p("",!0)],64)):t.currentTab==="有效"?(a(),d("span",Nt,[r(" 有效 "),Kt])):t.currentTab==="尚未生效"?(a(),d("span",Bt,[r(" 尚未生效 "),Gt])):t.currentTab==="已失效"?(a(),d("span",Et,[r(" 已失效 "),Lt])):p("",!0)]),e("td",null,[e("a",{class:_({"disabled-link":t.loadingStatus.loadingDelCoupon}),onClick:C(w=>l.openModal("edit",n.id),["prevent"])},It,10,Ft)]),e("td",null,[e("div",Rt,[e("a",{class:_({"disabled-link":t.loadingStatus.loadingDelCoupon}),onClick:C(w=>l.deleteCoupon(n.id),["prevent"])},jt,10,zt),t.loadingStatus.loadingDelCoupon===n.id?(a(),d("div",Yt,Ht)):p("",!0)])])]))),128))])])):t.loadingStatus.loadingGetCoupons?p("",!0):(a(),d("div",Ot,Jt))]),e("ul",Qt,[(a(!0),d(y,null,K(t.currentPageCoupons,n=>(a(),d("li",{class:"col-12",key:n.id},[e("div",Zt,[e("div",$t,[e("div",es,[e("div",ts,[e("div",ss,[r(h(n.code)+" ",1),u(g,{copyContent:n.code,type:"優惠碼"},null,8,["copyContent"])]),e("div",os,[t.currentTab==="所有優惠券"?(a(),d(y,{key:0},[l.dateToUnix()>n.start_date&&l.dateToUnix()<n.due_date?(a(),d("span",ns,[r(" 有效 "),ls])):p("",!0),l.dateToUnix()>n.due_date?(a(),d("span",as,[r(" 已失效 "),is])):p("",!0),l.dateToUnix()<n.start_date?(a(),d("span",ds,[r(" 尚未生效 "),cs])):p("",!0)],64)):t.currentTab==="有效"?(a(),d("span",us,[r(" 有效 "),rs])):t.currentTab==="尚未生效"?(a(),d("span",ps,[r(" 尚未生效 "),_s])):t.currentTab==="已失效"?(a(),d("span",ms,[r(" 已失效 "),hs])):p("",!0)])])]),e("div",bs,[e("div",gs,[e("p",fs,h(n.title),1),n.title==="金額折抵"?(a(),d("p",ys," 消費滿 NT$ "+h(n.min_buy_price_by_price)+"，享 NT$ "+h(n.discount_price)+" 折扣 ",1)):p("",!0),n.title==="訂單折扣"?(a(),d("p",vs," 消費滿 NT$ "+h(n.min_buy_price_by_discount)+"，享 "+h(n.percent%10?n.percent:n.percent/10)+" 折 ",1)):p("",!0)])]),e("div",Cs,[e("p",xs,h(l.unixToDate(n.start_date))+" 至 "+h(l.unixToDate(n.due_date)),1)]),e("div",ws,[e("div",ks,[e("a",{class:_({"disabled-link":t.loadingStatus.loadingDelCoupon}),onClick:C(w=>l.openModal("edit",n.id),["prevent"])},Ps,10,Ds),e("a",{href:"#",class:_({"disabled-link":t.loadingStatus.loadingDelCoupon}),onClick:C(w=>l.deleteCoupon(n.id),["prevent"])},[Ss,t.loadingStatus.loadingDelCoupon===n.id?(a(),d("div",Ms,Ns)):p("",!0)],10,Ts)])])])])]))),128))]),t.currentPageCoupons.length?(a(),d("div",Ks,[t.currentTab==="所有優惠券"&&!t.loadingStatus.loadingGetCoupons?(a(),k(f,{key:0,"total-items":t.coupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:t.currentPage,"onUpdate:modelValue":s[5]||(s[5]=n=>t.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active",backButtonClass:t.currentPage===1?"disabled":"back-button",nextButtonClass:t.currentPage===Math.ceil(t.coupons.length/10)?"disabled":"next-button"},{"prev-button":v(()=>[Bs]),"next-button":v(()=>[Gs]),_:1},8,["total-items","modelValue","onClick","backButtonClass","nextButtonClass"])):t.currentTab==="有效"&&!t.loadingStatus.loadingGetCoupons?(a(),k(f,{key:1,"total-items":t.validCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:t.currentPage,"onUpdate:modelValue":s[6]||(s[6]=n=>t.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active",backButtonClass:t.currentPage===1?"disabled":"back-button",nextButtonClass:t.currentPage===Math.ceil(t.validCoupons.length/10)?"disabled":"next-button"},{"prev-button":v(()=>[Es]),"next-button":v(()=>[Ls]),_:1},8,["total-items","modelValue","onClick","backButtonClass","nextButtonClass"])):t.currentTab==="尚未生效"&&!t.loadingStatus.loadingGetCoupons?(a(),k(f,{key:2,"total-items":t.notYetValidCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:t.currentPage,"onUpdate:modelValue":s[7]||(s[7]=n=>t.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active",backButtonClass:t.currentPage===1?"disabled":"back-button",nextButtonClass:t.currentPage===Math.ceil(t.notYetValidCoupons.length/10)?"disabled":"next-button"},{"prev-button":v(()=>[Fs]),"next-button":v(()=>[As]),_:1},8,["total-items","modelValue","onClick","backButtonClass","nextButtonClass"])):t.currentTab==="已失效"&&!t.loadingStatus.loadingGetCoupons?(a(),k(f,{key:3,"total-items":t.invalidCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:t.currentPage,"onUpdate:modelValue":s[8]||(s[8]=n=>t.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active",backButtonClass:t.currentPage===1?"disabled":"back-button",nextButtonClass:t.currentPage===Math.ceil(t.invalidCoupons.length/10)?"disabled":"next-button"},{"prev-button":v(()=>[Is]),"next-button":v(()=>[Rs]),_:1},8,["total-items","modelValue","onClick","backButtonClass","nextButtonClass"])):p("",!0)])):p("",!0),t.loadingStatus.loadingGetCoupons?(a(),d("div",zs,js)):p("",!0)]),u(S,{active:t.isLoading},null,8,["active"]),u(M,{ref:"adCouponModal",coupon:t.coupon,newCoupon:t.newCoupon,isNew:t.isNew,loadingStatus:t.loadingStatus,onUpdateCoupon:l.updateCoupon},null,8,["coupon","newCoupon","isNew","loadingStatus","onUpdateCoupon"])],64)}const eo=F(rt,[["render",Ys]]);export{eo as default};
