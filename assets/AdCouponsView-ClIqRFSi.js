import{M as R}from"./modal-C1luRkuP.js";import{W as L,_ as F,o as i,c as d,b as e,y as w,w as y,g as v,e as u,x as m,h as S,V as M,F as f,f as c,j as p,r as P,t as h,k as C,m as B}from"./index-CtjhObmR.js";import{c as j}from"./copyTextStore-DqjnCJLA.js";import{d as k}from"./dateToUnix-DUte0kxx.js";import{t as D,a as K}from"./sweetalertToast-Bltzl3rX.js";import{s as W}from"./scrollToTop-BdmBcgwt.js";import"./selector-engine-BKn3vPqV.js";import"./sweetalert2.all-D7bwkDQL.js";function q(o){const t=o.getFullYear(),r=(o.getMonth()+1).toString().padStart(2,"0"),_=o.getDate().toString().padStart(2,"0");return`${t}-${r}-${_}`}function z(o){const t=new Date(o);return q(t)}L("compareWithDiscount",(o,[t])=>typeof o=="number"&&typeof t=="number"?o>=t?!0:"折抵金額不可大於訂單金額":!0);L("compareWithPrice",(o,[t])=>typeof o=="number"&&typeof t=="number"?o<=t?!0:"折抵金額不可大於訂單金額":!0);const A={props:["coupon","isNew","loadingStatus","newCoupon"],data(){return{modal:"",couponData:"",newCouponData:""}},methods:{reset(){this.$refs.couponForm.resetForm()},openModal(){this.modal.show()},closeModal(){this.modal.hide()},unixToDate(o){const t=o*1e3;return z(t)},format(o){const t=o.map(r=>q(r));return`${t[0]?t[0]:"請選擇日期"} 至 ${t[1]?t[1]:"請選擇日期"}`},blurValidate(){this.$refs.couponForm.validateField("日期")},updateCoupon(){this.isNew?this.$emit("updateCoupon",this.newCouponData):this.$emit("updateCoupon",this.couponData)},resetNewCoupon(){this.newCouponData={...this.newCoupon}},preventSpecialKey(o){const{code:t}=o;(t==="KeyE"||t==="NumpadAdd"||t==="NumpadSubtract"||t==="NumpadDecimal")&&o.preventDefault()}},watch:{coupon(){this.couponData={...this.coupon},this.couponData.dates=[this.couponData.start_date*1e3,this.couponData.due_date*1e3]}},computed:{discountsOption(){const o=[];for(let t=95;t>5;t-=5){let r="";const _=t;t%10?r=`${t} 折`:r=`${t/10} 折`,o.push([r,_])}return o}},mounted(){this.modal=new R(this.$refs.adCouponCompModal,{backdrop:!0})}},E={class:"modal fade ad-coupon",ref:"adCouponCompModal",role:"dialog"},Y={class:"modal-dialog modal-dialog-centered"},I={class:"modal-header bg-primary py-2 px-3"},H=e("h2",{class:"modal-title fs-5 fw-medium text-white"}," 建立優惠券1 ",-1),J=e("i",{class:"bi bi-x-lg text-white"},null,-1),O=[J],Q={class:"modal-body py-4 px-6"},X={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},Z=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),$=[Z],ee={key:1,class:"text-start"},te={class:"mb-3"},se=e("div",{class:"d-flex justify-content-between"},[e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*優惠碼"),e("p",null,"*為必填")],-1),oe={class:"mb-3"},ne=e("p",{class:"mb-3 fs-6"},"*優惠方式",-1),le={class:"form-check mb-3"},ae=e("label",{class:"form-check-label mb-2",for:"flexRadioDefault1"}," 訂單金額折抵 ",-1),ie={class:"d-flex flex-column gap-2 mb-3"},de={class:"fs-8"},ce={class:"fs-8"},re={class:"form-check"},ue=e("label",{class:"form-check-label mb-2",for:"flexRadioDefault2"}," 訂單折扣 ",-1),pe={class:"d-flex flex-column gap-2"},me={class:"fs-8"},_e={class:"fs-8"},he=e("option",{value:""},"請選擇折扣",-1),be=["value"],ge={class:"mb-3"},fe=e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*開始 / 結束日期",-1),ye={class:"modal-footer py-4 px-6"},ve=["disabled"],Ce=["disabled"],xe={class:"modal-header bg-primary py-2 px-3"},we=e("h2",{class:"modal-title fs-5 fw-medium text-white"}," 編輯優惠券 ",-1),ke=e("i",{class:"bi bi-x-lg text-white"},null,-1),De=[ke],Ve={class:"modal-body py-4 px-6"},Te={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},Se=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),Me=[Se],Pe={key:1,class:"text-start"},Ne={class:"mb-3"},Ue=e("div",{class:"d-flex justify-content-between"},[e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*優惠碼"),e("p",null,"*為必填")],-1),Ge={class:"mb-3"},Ke=e("p",{class:"mb-3 fs-6"},"*優惠方式",-1),Fe={class:"form-check mb-3"},Le=e("label",{class:"form-check-label mb-2",for:"flexRadioDefault1"}," 訂單金額折抵 ",-1),qe={class:"d-flex flex-column gap-2 mb-3"},ze={class:"fs-8"},Re={class:"fs-8"},Be={class:"form-check"},je=e("label",{class:"form-check-label mb-2",for:"flexRadioDefault2"}," 訂單折扣 ",-1),We={class:"d-flex flex-column gap-2"},Ae={class:"fs-8"},Ee={class:"fs-8"},Ye=e("option",{value:""},"請選擇折扣",-1),Ie=["value"],He={class:"mb-3"},Je=e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*開始 / 結束日期",-1),Oe={class:"modal-footer py-4 px-6"},Qe=["disabled"],Xe=["disabled"];function Ze(o,t,r,_,s,l){const g=C("VField"),b=C("ErrorMessage"),V=C("VueDatePicker"),T=C("VForm");return i(),d("div",E,[e("div",Y,[r.isNew?(i(),w(T,{key:0,class:"modal-content custom-form",ref:"couponForm",onSubmit:l.updateCoupon},{default:y(({errors:n,meta:x})=>[e("div",I,[H,e("a",{role:"button","aria-label":"Close",onClick:t[0]||(t[0]=v((...a)=>l.closeModal&&l.closeModal(...a),["prevent"]))},O)]),e("div",Q,[r.loadingStatus.loadingGetCoupon?(i(),d("div",X,$)):(i(),d("div",ee,[e("div",te,[se,u(g,{type:"text",name:"優惠碼",rules:"required|alpha_num|max:12",class:m(["form-control",{"is-invalid":n.優惠碼}]),id:"couponCode",placeholder:"設定 12 個字元以內的英文字母和數字",modelValue:s.newCouponData.code,"onUpdate:modelValue":t[1]||(t[1]=a=>s.newCouponData.code=a)},null,8,["class","modelValue"]),u(b,{name:"優惠碼",class:"invalid-feedback"})]),e("div",oe,[ne,e("div",le,[S(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault1",value:"金額折抵","onUpdate:modelValue":t[2]||(t[2]=a=>s.newCouponData.title=a)},null,512),[[M,s.newCouponData.title]]),ae,e("div",ie,[e("p",de,[s.newCouponData.title==="金額折抵"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventSpecialKey,name:"金額",rules:s.newCouponData.title==="金額折抵"?"required|compareWithDiscount:@折抵金額":"",class:m(["form-control",{"is-invalid":n.金額}]),placeholder:"設定金額",modelValue:s.newCouponData.min_buy_price_by_price,"onUpdate:modelValue":t[3]||(t[3]=a=>s.newCouponData.min_buy_price_by_price=a),modelModifiers:{number:!0},disabled:s.newCouponData.title==="訂單折扣"},null,8,["onKeydown","rules","class","modelValue","disabled"]),u(b,{name:"金額",class:"invalid-feedback"})]),e("p",ce,[s.newCouponData.title==="金額折抵"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("折抵金額 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventSpecialKey,name:"折抵金額",rules:s.newCouponData.title==="金額折抵"?"required|compareWithPrice:@金額":"",class:m(["form-control",{"is-invalid":n.折抵金額}]),placeholder:"設定金額",modelValue:s.newCouponData.discount_price,"onUpdate:modelValue":t[4]||(t[4]=a=>s.newCouponData.discount_price=a),modelModifiers:{number:!0},disabled:s.newCouponData.title==="訂單折扣"},null,8,["onKeydown","rules","class","modelValue","disabled"]),u(b,{name:"折抵金額",class:"invalid-feedback"})])])]),e("div",re,[S(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault2",value:"訂單折扣","onUpdate:modelValue":t[5]||(t[5]=a=>s.newCouponData.title=a)},null,512),[[M,s.newCouponData.title]]),ue,e("div",pe,[e("p",me,[s.newCouponData.title==="訂單折扣"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventSpecialKey,name:"消費金額",rules:{required:s.newCouponData.title==="訂單折扣"},class:m(["form-control",{"is-invalid":n.消費金額}]),placeholder:"設定金額",modelValue:s.newCouponData.min_buy_price_by_discount,"onUpdate:modelValue":t[6]||(t[6]=a=>s.newCouponData.min_buy_price_by_discount=a),modelModifiers:{number:!0},disabled:s.newCouponData.title==="金額折抵"},null,8,["onKeydown","rules","class","modelValue","disabled"]),u(b,{name:"消費金額",class:"invalid-feedback"})]),e("p",_e,[s.newCouponData.title==="訂單折扣"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("折扣 ")]),e("div",null,[u(g,{as:"select",name:"折扣",rules:{required:s.newCouponData.title==="訂單折扣"},class:m(["form-control",{"is-invalid":n.折扣}]),placeholder:"請選擇折扣",modelValue:s.newCouponData.percent,"onUpdate:modelValue":t[7]||(t[7]=a=>s.newCouponData.percent=a),disabled:s.newCouponData.title==="金額折抵"},{default:y(()=>[he,(i(!0),d(f,null,P(l.discountsOption,a=>(i(),d("option",{key:a[0],value:a[1]},h(a[0]),9,be))),128))]),_:2},1032,["rules","class","modelValue","disabled"]),u(b,{name:"折扣",class:"invalid-feedback"})])])])]),e("div",ge,[fe,u(g,{name:"日期",modelValue:s.newCouponData.dates,"onUpdate:modelValue":t[9]||(t[9]=a=>s.newCouponData.dates=a),rules:"required"},{default:y(()=>[u(V,{modelValue:s.newCouponData.dates,"onUpdate:modelValue":t[8]||(t[8]=a=>s.newCouponData.dates=a),"input-class-name":"border-0",class:m(["dp-custom form-control py-0 ps-0 pe-9",{"is-invalid":n.日期}]),"model-type":"timestamp",range:{partialRange:!1},format:l.format,"enable-time-picker":!1,locale:"zh-TW",cancelText:"取消",selectText:"選擇",onBlur:l.blurValidate},null,8,["modelValue","class","format","onBlur"])]),_:2},1032,["modelValue"]),u(b,{name:"日期",class:"invalid-feedback"})])]))]),e("div",ye,[e("button",{type:"button",class:"btn btn-outline-primary border-1",disabled:r.loadingStatus.loadingGetCoupon,onClick:t[10]||(t[10]=(...a)=>l.closeModal&&l.closeModal(...a))}," 取消 ",8,ve),e("button",{type:"submit",class:"btn btn-primary",disabled:r.loadingStatus.loadingGetCoupon||!x.valid},"確定",8,Ce)])]),_:1},8,["onSubmit"])):(i(),w(T,{key:1,class:"modal-content custom-form",ref:"couponForm",onSubmit:l.updateCoupon},{default:y(({errors:n,meta:x})=>[e("div",xe,[we,e("a",{role:"button","aria-label":"Close",onClick:t[11]||(t[11]=v((...a)=>l.closeModal&&l.closeModal(...a),["prevent"]))},De)]),e("div",Ve,[r.loadingStatus.loadingGetCoupon?(i(),d("div",Te,Me)):(i(),d("div",Pe,[e("div",Ne,[Ue,u(g,{type:"text",name:"優惠碼",rules:"required|alpha_num|max:12",class:m(["form-control",{"is-invalid":n.優惠碼}]),id:"couponCode",placeholder:"設定 12 個字元以內的英文字母和數字",modelValue:s.couponData.code,"onUpdate:modelValue":t[12]||(t[12]=a=>s.couponData.code=a)},null,8,["class","modelValue"]),u(b,{name:"優惠碼",class:"invalid-feedback"})]),e("div",Ge,[Ke,e("div",Fe,[S(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault1",value:"金額折抵","onUpdate:modelValue":t[13]||(t[13]=a=>s.couponData.title=a)},null,512),[[M,s.couponData.title]]),Le,e("div",qe,[e("p",ze,[s.couponData.title==="金額折抵"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventSpecialKey,name:"金額",rules:s.couponData.title==="金額折抵"?"required|compareWithDiscount:@折抵金額":"",class:m(["form-control",{"is-invalid":n.金額}]),placeholder:"設定金額",modelValue:s.couponData.min_buy_price_by_price,"onUpdate:modelValue":t[14]||(t[14]=a=>s.couponData.min_buy_price_by_price=a),modelModifiers:{number:!0},disabled:s.couponData.title==="訂單折扣"},null,8,["onKeydown","rules","class","modelValue","disabled"]),u(b,{name:"金額",class:"invalid-feedback"})]),e("p",Re,[s.couponData.title==="金額折抵"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("折抵金額 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventSpecialKey,name:"折抵金額",rules:s.couponData.title==="金額折抵"?"required|compareWithPrice:@金額":"",class:m(["form-control",{"is-invalid":n.折抵金額}]),placeholder:"設定金額",modelValue:s.couponData.discount_price,"onUpdate:modelValue":t[15]||(t[15]=a=>s.couponData.discount_price=a),modelModifiers:{number:!0},disabled:s.couponData.title==="訂單折扣"},null,8,["onKeydown","rules","class","modelValue","disabled"]),u(b,{name:"折抵金額",class:"invalid-feedback"})])])]),e("div",Be,[S(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault2",value:"訂單折扣","onUpdate:modelValue":t[16]||(t[16]=a=>s.couponData.title=a)},null,512),[[M,s.couponData.title]]),je,e("div",We,[e("p",Ae,[s.couponData.title==="訂單折扣"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("消費滿 NT$ ")]),e("div",null,[u(g,{type:"number",onKeydown:l.preventSpecialKey,name:"消費金額",rules:{required:s.couponData.title==="訂單折扣"},class:m(["form-control",{"is-invalid":n.消費金額}]),placeholder:"設定金額",modelValue:s.couponData.min_buy_price_by_discount,"onUpdate:modelValue":t[17]||(t[17]=a=>s.couponData.min_buy_price_by_discount=a),modelModifiers:{number:!0},disabled:s.couponData.title==="金額折抵"},null,8,["onKeydown","rules","class","modelValue","disabled"]),u(b,{name:"消費金額",class:"invalid-feedback"})]),e("p",Ee,[s.couponData.title==="訂單折扣"?(i(),d(f,{key:0},[c("*")],64)):p("",!0),c("折扣 ")]),e("div",null,[u(g,{as:"select",name:"折扣",rules:{required:s.couponData.title==="訂單折扣"},class:m(["form-control",{"is-invalid":n.折扣}]),placeholder:"請選擇折扣",modelValue:s.couponData.percent,"onUpdate:modelValue":t[18]||(t[18]=a=>s.couponData.percent=a),disabled:s.couponData.title==="金額折抵"},{default:y(()=>[Ye,(i(!0),d(f,null,P(l.discountsOption,a=>(i(),d("option",{key:a[0],value:a[1]},h(a[0]),9,Ie))),128))]),_:2},1032,["rules","class","modelValue","disabled"]),u(b,{name:"折扣",class:"invalid-feedback"})])])])]),e("div",He,[Je,u(g,{name:"日期",modelValue:s.couponData.dates,"onUpdate:modelValue":t[20]||(t[20]=a=>s.couponData.dates=a),rules:"required"},{default:y(()=>[u(V,{modelValue:s.couponData.dates,"onUpdate:modelValue":t[19]||(t[19]=a=>s.couponData.dates=a),"input-class-name":"border-0",class:m(["dp-custom form-control py-0 ps-0 pe-9",{"is-invalid":n.日期}]),"model-type":"timestamp",range:{partialRange:!1},format:l.format,"enable-time-picker":!1,locale:"zh-TW",cancelText:"取消",selectText:"選擇",onBlur:l.blurValidate},null,8,["modelValue","class","format","onBlur"])]),_:2},1032,["modelValue"]),u(b,{name:"日期",class:"invalid-feedback"})])]))]),e("div",Oe,[e("button",{type:"button",class:"btn btn-outline-primary border-1",disabled:r.loadingStatus.loadingGetCoupon,onClick:t[21]||(t[21]=(...a)=>l.closeModal&&l.closeModal(...a))}," 取消 ",8,Qe),e("button",{type:"submit",class:"btn btn-primary",disabled:r.loadingStatus.loadingGetCoupon||!x.valid},"確定",8,Xe)])]),_:1},8,["onSubmit"]))])],512)}const $e=F(A,[["render",Ze]]),et={props:["copyContent","type"],methods:{...B(j,["copyTextMethod"]),copyText(){this.copyTextMethod(this.copyContent,this.type)}}},tt=e("i",{class:"bi bi-copy"},null,-1),st=[tt];function ot(o,t,r,_,s,l){return i(),d("a",{href:"#",class:"ms-1",onClick:t[0]||(t[0]=v((...g)=>l.copyText&&l.copyText(...g),["prevent"]))},st)}const nt=F(et,[["render",ot]]),N="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%23198754'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm-2%2015-5-5%201.41-1.41L10%2014.17l7.59-7.59L19%208l-9%209z'/%3e%3c/svg%3e",U="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%23dc3545'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.47%202%202%206.47%202%2012s4.47%2010%2010%2010%2010-4.47%2010-10S17.53%202%2012%202zm5%2013.59L15.59%2017%2012%2013.41%208.41%2017%207%2015.59%2010.59%2012%207%208.41%208.41%207%2012%2010.59%2015.59%207%2017%208.41%2013.41%2012%2017%2015.59z'/%3e%3c/svg%3e",G="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%239f9f9f'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm5%2011H7v-2h10v2z'/%3e%3c/svg%3e",lt={data(){return{currentTab:"所有優惠券",currentPageCoupons:[],currentPage:1,coupons:[],validCoupons:[],notYetValidCoupons:[],InvalidCoupons:[],coupon:{},newCoupon:{title:"金額折抵"},isNew:!0,isLoading:!1,loadingStatus:{loadingGetCoupons:!1,loadingGetCoupon:!1,loadingDelCoupon:""}}},components:{AdCouponModal:$e,CopyText:nt},methods:{async getCoupons(){try{this.loadingStatus.loadingGetCoupons=!0,this.coupons=[],this.validCoupons=[],this.InvalidCoupons=[],this.notYetValidCoupons=[],this.currentPageCoupons=[];let o,t;const r="https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupons",_=await this.$http.get(r);for(this.coupons=_.data.coupons,o=_.data.pagination.current_page+1,t=_.data.pagination.total_pages;o<=t;){const s=await this.$http.get(`${r}?page=${o}`);this.coupons=[...this.coupons,...s.data.coupons],o++}this.filterCoupons(),this.changePage(this.currentPage)}catch(o){D(o.response.data.message)}finally{this.loadingStatus.loadingGetCoupons=!1}},filterCoupons(){this.coupons.forEach(o=>{k("now")>o.start_date&&k("now")<o.due_date?this.validCoupons.push(o):k("now")>o.due_date?this.InvalidCoupons.push(o):k("now")<o.start_date&&this.notYetValidCoupons.push(o)})},changePage(o){switch(this.currentTab){case"所有優惠券":this.currentPageCoupons=this.coupons.slice((o-1)*10,o*10);break;case"有效":this.currentPageCoupons=this.validCoupons.slice((o-1)*10,o*10);break;case"尚未生效":this.currentPageCoupons=this.notYetValidCoupons.slice((o-1)*10,o*10);break;case"已失效":this.currentPageCoupons=this.InvalidCoupons.slice((o-1)*10,o*10);break}W()},changeTab(o){this.currentTab=o,this.currentPage=1,this.changePage(this.currentPage)},async getCoupon(o){try{this.loadingStatus.loadingGetCoupon=!0;const r=await this.$http.get("https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupons");this.coupon=r.data.coupons.find(_=>_.id===o),this.loadingStatus.loadingGetCoupon=!1}catch(t){D(t.response.data.message)}finally{this.loadingStatus.loadingGetCoupon=!1}},updateCoupon(o){this.loadingStatus.loadingGetCoupon=!0;const t={title:o.title,is_enabled:1,percent:o.title==="金額折抵"?100:o.percent,start_date:o.dates[0]/1e3,due_date:o.dates[1]/1e3,code:o.code};if(o.title==="金額折抵"?(t.min_buy_price_by_price=o.min_buy_price_by_price,t.discount_price=o.discount_price,t.min_buy_price_by_discount=""):o.title==="訂單折扣"&&(t.min_buy_price_by_discount=o.min_buy_price_by_discount,t.min_buy_price_by_price="",t.discount_price=""),this.isNew)this.$http.post("https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupon",{data:t}).then(_=>{K(_.data.message),this.$refs.adCouponModal.closeModal(),this.getCoupons()}).catch(_=>{D(_.response.data.message)}).finally(()=>{this.loadingStatus.loadingGetCoupon=!1});else if(!this.isNew){const _=`https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupon/${o.id}`;this.$http.put(_,{data:t}).then(s=>{K(s.data.message),this.$refs.adCouponModal.closeModal(),this.getCoupons()}).catch(s=>{D(s.response.data.message)}).finally(()=>{this.loadingStatus.loadingGetCoupon=!1})}},deleteCoupon(o){this.loadingStatus.loadingDelCoupon=o;const t=`https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupon/${o}`;this.$http.delete(t).then(r=>{K(r.data.message),this.getCoupons()}).catch(r=>{D(r.response.data.message)}).finally(()=>{this.loadingStatus.loadingDelCoupon=""})},async openModal(o,t){switch(o){case"new":this.$refs.adCouponModal.reset(),this.isNew=!0,this.$refs.adCouponModal.resetNewCoupon(),this.$refs.adCouponModal.openModal();break;case"edit":this.isNew=!1,this.$refs.adCouponModal.openModal(),await this.getCoupon(t);break}},unixToDate(o){const t=o*1e3;return z(t)},dateToUnix(o="now"){return k(o)}},mounted(){this.getCoupons()}},at={class:"ad-coupon px-lg-10 pt-3 pt-lg-10 text-start"},it=e("h1",{class:"fs-3 mb-4 fw-bold"},"優惠管理",-1),dt={class:"nav flex-nowrap text-nowrap overflow-x-scroll overflow-x-sm-auto border-bottom border-primary mb-4"},ct={class:"nav-item"},rt={class:"nav-item"},ut={class:"nav-item"},pt={class:"nav-item"},mt={class:"table-container table-responsive d-none d-lg-block"},_t={class:"table align-middle text-nowrap mb-4"},ht=e("thead",{class:"table-head position-relative"},[e("tr",null,[e("th",{style:{width:"15%"}},"優惠碼"),e("th",{style:{width:"30%"}},"優惠型式"),e("th",{style:{width:"15%"}},"開始日期"),e("th",{style:{width:"15%"}},"結束日期"),e("th",{style:{width:"15%"}},"狀態"),e("th",{style:{width:"5%"}}),e("th",{style:{width:"5%"}})])],-1),bt={class:"py-5"},gt={class:"fw-bold mb-4"},ft={key:0},yt={key:1},vt={key:0,class:"text-success"},Ct=e("img",{src:N,alt:"有效",class:"align-top"},null,-1),xt={key:1,class:"text-danger"},wt=e("img",{src:U,alt:"已失效",class:"align-top"},null,-1),kt={key:2},Dt=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),Vt={key:1,class:"text-success"},Tt=e("img",{src:N,alt:"有效",class:"align-top"},null,-1),St={key:2},Mt=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),Pt={key:3,class:"text-danger"},Nt=e("img",{src:U,alt:"已失效",class:"align-top"},null,-1),Ut=["onClick"],Gt=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),Kt=[Gt],Ft={class:"d-flex align-items-center"},Lt=["onClick"],qt=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),zt=[qt],Rt={key:0,class:"spinner-border spinner-border-sm",role:"status"},Bt=e("span",{class:"visually-hidden"},"Loading...",-1),jt=[Bt],Wt={class:"row list-unstyled text-dark d-lg-none",style:{"row-gap":"12px"}},At={class:"border border-primary rounded overflow-hidden"},Et={class:"row g-0"},Yt={class:"col-12"},It={class:"bg-primary d-flex justify-content-between align-items-center px-2 py-2"},Ht={class:"bg-primary text-white fw-bold"},Jt=e("i",{class:"bi bi-copy"},null,-1),Ot={class:"text-end bg-white rounded-pill px-2 py-1 fs-8"},Qt={key:0,class:"text-success"},Xt=e("img",{src:N,alt:"有效",class:"align-top"},null,-1),Zt={key:1,class:"text-danger"},$t=e("img",{src:U,alt:"已失效",class:"align-top"},null,-1),es={key:2},ts=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),ss={key:1,class:"text-success"},os=e("img",{src:N,alt:"有效",class:"align-top"},null,-1),ns={key:2},ls=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),as={key:3,class:"text-danger"},is=e("img",{src:U,alt:"已失效",class:"align-top"},null,-1),ds={class:"col-12"},cs={class:"px-2 py-2 border-bottom border-primary"},rs={class:"fw-bold mb-2"},us={key:0},ps={key:1},ms={class:"col-9"},_s={class:"px-2 py-2"},hs={class:"col-3"},bs={class:"d-flex justify-content-between justify-content-sm-evenly pe-4 py-2"},gs=["onClick"],fs=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),ys=[fs],vs=["onClick"],Cs=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),xs={key:0,class:"spinner-border spinner-border-sm",role:"status"},ws=e("span",{class:"visually-hidden"},"Loading...",-1),ks=[ws],Ds={class:"text-center va-pagination"},Vs=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Ts=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Ss=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Ms=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Ps=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Ns=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Us=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Gs=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Ks={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},Fs=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),Ls=[Fs];function qs(o,t,r,_,s,l){const g=C("CopyText"),b=C("vue-awesome-paginate"),V=C("VueLoading"),T=C("AdCouponModal");return i(),d(f,null,[e("div",at,[it,e("ul",dt,[e("li",ct,[e("a",{class:m(["nav-link px-6 py-4",{active:s.currentTab==="所有優惠券"}]),href:"#",onClick:t[0]||(t[0]=v(n=>l.changeTab("所有優惠券"),["prevent"]))}," 所有優惠券 ",2)]),e("li",rt,[e("a",{class:m(["nav-link px-6 py-4",{active:s.currentTab==="有效"}]),href:"#",onClick:t[1]||(t[1]=v(n=>l.changeTab("有效"),["prevent"]))}," 有效 ",2)]),e("li",ut,[e("a",{class:m(["nav-link px-6 py-4",{active:s.currentTab==="尚未生效"}]),href:"#",onClick:t[2]||(t[2]=v(n=>l.changeTab("尚未生效"),["prevent"]))}," 尚未生效 ",2)]),e("li",pt,[e("a",{class:m(["nav-link px-6 py-4",{active:s.currentTab==="已失效"}]),href:"#",onClick:t[3]||(t[3]=v(n=>l.changeTab("已失效"),["prevent"]))}," 已失效 ",2)])]),e("a",{href:"#",class:"btn btn-primary mb-4",onClick:t[4]||(t[4]=v(n=>l.openModal("new"),["prevent"]))},"新增優惠券"),e("div",mt,[e("table",_t,[ht,e("tbody",null,[(i(!0),d(f,null,P(s.currentPageCoupons,n=>(i(),d("tr",{key:n.id},[e("td",null,[c(h(n.code)+" ",1),u(g,{copyContent:n.code,type:"優惠碼"},null,8,["copyContent"])]),e("td",bt,[e("p",gt,h(n.title),1),n.title==="金額折抵"?(i(),d("p",ft," 消費滿 NT$ "+h(n.min_buy_price_by_price)+"，享 NT$ "+h(n.discount_price)+" 折扣 ",1)):p("",!0),n.title==="訂單折扣"?(i(),d("p",yt," 消費滿 NT$ "+h(n.min_buy_price_by_discount)+"，享 "+h(n.percent%10?n.percent:n.percent/10)+" 折 ",1)):p("",!0)]),e("td",null,h(l.unixToDate(n.start_date)),1),e("td",null,h(l.unixToDate(n.due_date)),1),e("td",null,[s.currentTab==="所有優惠券"?(i(),d(f,{key:0},[l.dateToUnix()>n.start_date&&l.dateToUnix()<n.due_date?(i(),d("span",vt,[c(" 有效 "),Ct])):p("",!0),l.dateToUnix()>n.due_date?(i(),d("span",xt,[c(" 已失效 "),wt])):p("",!0),l.dateToUnix()<n.start_date?(i(),d("span",kt,[c(" 尚未生效 "),Dt])):p("",!0)],64)):s.currentTab==="有效"?(i(),d("span",Vt,[c(" 有效 "),Tt])):s.currentTab==="尚未生效"?(i(),d("span",St,[c(" 尚未生效 "),Mt])):s.currentTab==="已失效"?(i(),d("span",Pt,[c(" 已失效 "),Nt])):p("",!0)]),e("td",null,[e("a",{href:"#",class:m({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:v(x=>l.openModal("edit",n.id),["prevent"])},Kt,10,Ut)]),e("td",null,[e("div",Ft,[e("a",{href:"#",class:m({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:v(x=>l.deleteCoupon(n.id),["prevent"])},zt,10,Lt),s.loadingStatus.loadingDelCoupon===n.id?(i(),d("div",Rt,jt)):p("",!0)])])]))),128))])])]),e("ul",Wt,[(i(!0),d(f,null,P(s.currentPageCoupons,n=>(i(),d("li",{class:"col-12",key:n.id},[e("div",At,[e("div",Et,[e("div",Yt,[e("div",It,[e("div",Ht,[c(h(n.code)+" ",1),Jt]),e("div",Ot,[s.currentTab==="所有優惠券"?(i(),d(f,{key:0},[l.dateToUnix()>n.start_date&&l.dateToUnix()<n.due_date?(i(),d("span",Qt,[c(" 有效 "),Xt])):p("",!0),l.dateToUnix()>n.due_date?(i(),d("span",Zt,[c(" 已失效 "),$t])):p("",!0),l.dateToUnix()<n.start_date?(i(),d("span",es,[c(" 尚未生效 "),ts])):p("",!0)],64)):s.currentTab==="有效"?(i(),d("span",ss,[c(" 有效 "),os])):s.currentTab==="尚未生效"?(i(),d("span",ns,[c(" 尚未生效 "),ls])):s.currentTab==="已失效"?(i(),d("span",as,[c(" 已失效 "),is])):p("",!0)])])]),e("div",ds,[e("div",cs,[e("p",rs,h(n.title),1),n.title==="金額折抵"?(i(),d("p",us," 消費滿 NT$ "+h(n.min_buy_price_by_price)+"，享 NT$ "+h(n.discount_price)+" 折扣 ",1)):p("",!0),n.title==="訂單折扣"?(i(),d("p",ps," 消費滿 NT$ "+h(n.min_buy_price_by_discount)+"，享 "+h(n.percent%10?n.percent:n.percent/10)+" 折 ",1)):p("",!0)])]),e("div",ms,[e("p",_s,h(l.unixToDate(n.start_date))+" 至 "+h(l.unixToDate(n.due_date)),1)]),e("div",hs,[e("div",bs,[e("a",{href:"#",class:m({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:v(x=>l.openModal("edit",n.id),["prevent"])},ys,10,gs),e("a",{href:"#",class:m({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:v(x=>l.deleteCoupon(n.id),["prevent"])},[Cs,s.loadingStatus.loadingDelCoupon===n.id?(i(),d("div",xs,ks)):p("",!0)],10,vs)])])])])]))),128))]),e("div",Ds,[s.currentTab==="所有優惠券"&&!s.loadingStatus.loadingGetCoupons?(i(),w(b,{key:0,"total-items":s.coupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[5]||(t[5]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":y(()=>[Vs]),"next-button":y(()=>[Ts]),_:1},8,["total-items","modelValue","onClick"])):s.currentTab==="有效"&&!s.loadingStatus.loadingGetCoupons?(i(),w(b,{key:1,"total-items":s.validCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[6]||(t[6]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":y(()=>[Ss]),"next-button":y(()=>[Ms]),_:1},8,["total-items","modelValue","onClick"])):s.currentTab==="尚未生效"&&!s.loadingStatus.loadingGetCoupons?(i(),w(b,{key:2,"total-items":s.notYetValidCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[7]||(t[7]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":y(()=>[Ps]),"next-button":y(()=>[Ns]),_:1},8,["total-items","modelValue","onClick"])):s.currentTab==="已失效"&&!s.loadingStatus.loadingGetCoupons?(i(),w(b,{key:3,"total-items":s.InvalidCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[8]||(t[8]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":y(()=>[Us]),"next-button":y(()=>[Gs]),_:1},8,["total-items","modelValue","onClick"])):p("",!0)]),s.loadingStatus.loadingGetCoupons?(i(),d("div",Ks,Ls)):p("",!0)]),u(V,{active:s.isLoading},null,8,["active"]),u(T,{ref:"adCouponModal",coupon:s.coupon,newCoupon:s.newCoupon,isNew:s.isNew,loadingStatus:s.loadingStatus,onUpdateCoupon:l.updateCoupon},null,8,["coupon","newCoupon","isNew","loadingStatus","onUpdateCoupon"])],64)}const Is=F(lt,[["render",qs]]);export{Is as default};
