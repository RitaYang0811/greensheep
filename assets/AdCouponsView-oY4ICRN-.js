import{M as R}from"./modal-B3R5G9nD.js";import{W as q,_ as L,o as i,c as d,b as e,x as k,w as v,f as C,d as c,u as _,g as P,V as M,F as y,e as r,i as p,r as K,t as h,j as w,p as j,k as I,m as W}from"./index-CS2eoewo.js";import{c as Y}from"./copyTextStore-D_PH2ny3.js";import{d as D}from"./dateToUnix-DUte0kxx.js";import{t as V,a as F}from"./sweetalertToast-D11lo59O.js";import{s as A}from"./scrollToTop-BdmBcgwt.js";import"./selector-engine-DAqM7RZT.js";import"./sweetalert2.all-BpO3uanp.js";function z(o){const t=o.getFullYear(),u=(o.getMonth()+1).toString().padStart(2,"0"),m=o.getDate().toString().padStart(2,"0");return`${t}-${u}-${m}`}function B(o){const t=new Date(o);return z(t)}q("compareWithDiscount",(o,[t])=>typeof o=="number"&&typeof t=="number"?o>=t?!0:"折抵金額不可大於訂單金額":!0);q("compareWithPrice",(o,[t])=>typeof o=="number"&&typeof t=="number"?o<=t?!0:"折抵金額不可大於訂單金額":!0);const E={props:["coupon","isNew","loadingStatus","newCoupon"],data(){return{modal:"",couponData:"",newCouponData:""}},methods:{reset(){this.$refs.couponForm.resetForm()},openModal(){this.modal.show()},closeModal(){this.modal.hide()},unixToDate(o){const t=o*1e3;return B(t)},format(o){const t=o.map(u=>z(u));return`${t[0]?t[0]:"請選擇日期"} 至 ${t[1]?t[1]:"請選擇日期"}`},blurValidate(){this.$refs.couponForm.validateField("日期")},updateCoupon(){this.isNew?this.$emit("updateCoupon",this.newCouponData):this.$emit("updateCoupon",this.couponData)},resetNewCoupon(){this.newCouponData={...this.newCoupon}},preventKeydownSpecialKey(o){const{key:t}=o;/\d|Backspace|Tab|Control|v/.test(t)||o.preventDefault()},preventPasteSpecialKey(o){const t=o.clipboardData.getData("text");/^\d+$/.test(t)||o.preventDefault()}},watch:{coupon(){this.couponData={...this.coupon},this.couponData.dates=[this.couponData.start_date*1e3,this.couponData.due_date*1e3]}},computed:{discountsOption(){const o=[];for(let t=95;t>5;t-=5){let u="";const m=t;t%10?u=`${t} 折`:u=`${t/10} 折`,o.push([u,m])}return o}},mounted(){this.modal=new R(this.$refs.adCouponCompModal,{backdrop:!0})}},b=o=>(j("data-v-450a39c5"),o=o(),I(),o),H={class:"modal fade ad-coupon",ref:"adCouponCompModal",role:"dialog"},J={class:"modal-dialog modal-dialog-centered"},O={class:"modal-header bg-primary py-2 px-3"},Q=b(()=>e("h2",{class:"modal-title fs-5 fw-medium text-white"}," 建立優惠券 ",-1)),X=b(()=>e("i",{class:"bi bi-x-lg text-white"},null,-1)),Z=[X],$={class:"modal-body py-4 px-6"},ee={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},te=b(()=>e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),se=[te],oe={key:1,class:"text-start"},ne={class:"mb-3"},le=b(()=>e("div",{class:"d-flex justify-content-between"},[e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*優惠碼"),e("p",null,"*為必填")],-1)),ae={class:"mb-3"},ie=b(()=>e("p",{class:"mb-3 fs-6"},"*優惠方式",-1)),de={class:"form-check mb-3"},ce=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault1"}," 訂單金額折抵 ",-1)),re={class:"d-flex flex-column gap-2 mb-3"},ue={class:"fs-8"},pe={class:"fs-8"},_e={class:"form-check"},me=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault2"}," 訂單折扣 ",-1)),he={class:"d-flex flex-column gap-2"},be={class:"fs-8"},ge={class:"fs-8"},fe=b(()=>e("option",{value:""},"請選擇折扣",-1)),ye=["value"],ve={class:"mb-3"},Ce=b(()=>e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*開始 / 結束日期",-1)),we={class:"modal-footer py-4 px-6"},xe=["disabled"],ke=["disabled"],De={class:"modal-header bg-primary py-2 px-3"},Ve=b(()=>e("h2",{class:"modal-title fs-5 fw-medium text-white"}," 編輯優惠券 ",-1)),Te=b(()=>e("i",{class:"bi bi-x-lg text-white"},null,-1)),Se=[Te],Pe={class:"modal-body py-4 px-6"},Me={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},Ke=b(()=>e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),Ue=[Ke],Ne={key:1,class:"text-start"},Ge={class:"mb-3"},Fe=b(()=>e("div",{class:"d-flex justify-content-between"},[e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*優惠碼"),e("p",null,"*為必填")],-1)),Le={class:"mb-3"},qe=b(()=>e("p",{class:"mb-3 fs-6"},"*優惠方式",-1)),ze={class:"form-check mb-3"},Be=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault1"}," 訂單金額折抵 ",-1)),Re={class:"d-flex flex-column gap-2 mb-3"},je={class:"fs-8"},Ie={class:"fs-8"},We={class:"form-check"},Ye=b(()=>e("label",{class:"form-check-label mb-2",for:"flexRadioDefault2"}," 訂單折扣 ",-1)),Ae={class:"d-flex flex-column gap-2"},Ee={class:"fs-8"},He={class:"fs-8"},Je=b(()=>e("option",{value:""},"請選擇折扣",-1)),Oe=["value"],Qe={class:"mb-3"},Xe=b(()=>e("label",{for:"couponCode",class:"form-label fs-6 mb-3"},"*開始 / 結束日期",-1)),Ze={class:"modal-footer py-4 px-6"},$e=["disabled"],et=["disabled"];function tt(o,t,u,m,s,l){const g=w("VField"),f=w("ErrorMessage"),T=w("VueDatePicker"),S=w("VForm");return i(),d("div",H,[e("div",J,[u.isNew?(i(),k(S,{key:0,class:"modal-content custom-form",ref:"couponForm",onSubmit:l.updateCoupon},{default:v(({errors:n,meta:x})=>[e("div",O,[Q,e("a",{role:"button","aria-label":"Close",onClick:t[0]||(t[0]=C((...a)=>l.closeModal&&l.closeModal(...a),["prevent"]))},Z)]),e("div",$,[u.loadingStatus.loadingGetCoupon?(i(),d("div",ee,se)):(i(),d("div",oe,[e("div",ne,[le,c(g,{type:"text",name:"優惠碼",rules:"required|alpha_num|max:12",class:_(["form-control",{"is-invalid":n.優惠碼}]),id:"couponCode",placeholder:"設定 12 個字元以內的英文字母和數字",modelValue:s.newCouponData.code,"onUpdate:modelValue":t[1]||(t[1]=a=>s.newCouponData.code=a)},null,8,["class","modelValue"]),c(f,{name:"優惠碼",class:"invalid-feedback"})]),e("div",ae,[ie,e("div",de,[P(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault1",value:"金額折抵","onUpdate:modelValue":t[2]||(t[2]=a=>s.newCouponData.title=a)},null,512),[[M,s.newCouponData.title]]),ce,e("div",re,[e("p",ue,[s.newCouponData.title==="金額折抵"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[c(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"金額",rules:s.newCouponData.title==="金額折抵"?"required|compareWithDiscount:@折抵金額":"",class:_(["form-control",{"is-invalid":n.金額}]),placeholder:"設定金額",modelValue:s.newCouponData.min_buy_price_by_price,"onUpdate:modelValue":t[3]||(t[3]=a=>s.newCouponData.min_buy_price_by_price=a),modelModifiers:{number:!0},disabled:s.newCouponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),c(f,{name:"金額",class:"invalid-feedback"})]),e("p",pe,[s.newCouponData.title==="金額折抵"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("折抵金額 NT$ ")]),e("div",null,[c(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"折抵金額",rules:s.newCouponData.title==="金額折抵"?"required|compareWithPrice:@金額":"",class:_(["form-control",{"is-invalid":n.折抵金額}]),placeholder:"設定金額",modelValue:s.newCouponData.discount_price,"onUpdate:modelValue":t[4]||(t[4]=a=>s.newCouponData.discount_price=a),modelModifiers:{number:!0},disabled:s.newCouponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),c(f,{name:"折抵金額",class:"invalid-feedback"})])])]),e("div",_e,[P(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault2",value:"訂單折扣","onUpdate:modelValue":t[5]||(t[5]=a=>s.newCouponData.title=a)},null,512),[[M,s.newCouponData.title]]),me,e("div",he,[e("p",be,[s.newCouponData.title==="訂單折扣"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[c(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"消費金額",rules:{required:s.newCouponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.消費金額}]),placeholder:"設定金額",modelValue:s.newCouponData.min_buy_price_by_discount,"onUpdate:modelValue":t[6]||(t[6]=a=>s.newCouponData.min_buy_price_by_discount=a),modelModifiers:{number:!0},disabled:s.newCouponData.title==="金額折抵"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),c(f,{name:"消費金額",class:"invalid-feedback"})]),e("p",ge,[s.newCouponData.title==="訂單折扣"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("折扣 ")]),e("div",null,[c(g,{as:"select",name:"折扣",rules:{required:s.newCouponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.折扣}]),placeholder:"請選擇折扣",modelValue:s.newCouponData.percent,"onUpdate:modelValue":t[7]||(t[7]=a=>s.newCouponData.percent=a),disabled:s.newCouponData.title==="金額折抵"},{default:v(()=>[fe,(i(!0),d(y,null,K(l.discountsOption,a=>(i(),d("option",{key:a[0],value:a[1]},h(a[0]),9,ye))),128))]),_:2},1032,["rules","class","modelValue","disabled"]),c(f,{name:"折扣",class:"invalid-feedback"})])])])]),e("div",ve,[Ce,c(g,{name:"日期",modelValue:s.newCouponData.dates,"onUpdate:modelValue":t[9]||(t[9]=a=>s.newCouponData.dates=a),rules:"required"},{default:v(()=>[c(T,{modelValue:s.newCouponData.dates,"onUpdate:modelValue":t[8]||(t[8]=a=>s.newCouponData.dates=a),"input-class-name":"border-0",class:_(["dp-custom form-control py-0 ps-0 pe-9",{"is-invalid":n.日期}]),"model-type":"timestamp",range:{partialRange:!1},format:l.format,"enable-time-picker":!1,locale:"zh-TW",cancelText:"取消",selectText:"選擇",onBlur:l.blurValidate},null,8,["modelValue","class","format","onBlur"])]),_:2},1032,["modelValue"]),c(f,{name:"日期",class:"invalid-feedback"})])]))]),e("div",we,[e("button",{type:"button",class:"btn btn-outline-primary border-1",disabled:u.loadingStatus.loadingGetCoupon,onClick:t[10]||(t[10]=(...a)=>l.closeModal&&l.closeModal(...a))}," 取消 ",8,xe),e("button",{type:"submit",class:"btn btn-primary",disabled:u.loadingStatus.loadingGetCoupon||!x.valid}," 確定 ",8,ke)])]),_:1},8,["onSubmit"])):(i(),k(S,{key:1,class:"modal-content custom-form",ref:"couponForm",onSubmit:l.updateCoupon},{default:v(({errors:n,meta:x})=>[e("div",De,[Ve,e("a",{role:"button","aria-label":"Close",onClick:t[11]||(t[11]=C((...a)=>l.closeModal&&l.closeModal(...a),["prevent"]))},Se)]),e("div",Pe,[u.loadingStatus.loadingGetCoupon?(i(),d("div",Me,Ue)):(i(),d("div",Ne,[e("div",Ge,[Fe,c(g,{type:"text",name:"優惠碼",rules:"required|alpha_num|max:12",class:_(["form-control",{"is-invalid":n.優惠碼}]),id:"couponCode",placeholder:"設定 12 個字元以內的英文字母和數字",modelValue:s.couponData.code,"onUpdate:modelValue":t[12]||(t[12]=a=>s.couponData.code=a)},null,8,["class","modelValue"]),c(f,{name:"優惠碼",class:"invalid-feedback"})]),e("div",Le,[qe,e("div",ze,[P(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault1",value:"金額折抵","onUpdate:modelValue":t[13]||(t[13]=a=>s.couponData.title=a)},null,512),[[M,s.couponData.title]]),Be,e("div",Re,[e("p",je,[s.couponData.title==="金額折抵"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[c(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"金額",rules:s.couponData.title==="金額折抵"?"required|compareWithDiscount:@折抵金額":"",class:_(["form-control",{"is-invalid":n.金額}]),placeholder:"設定金額",modelValue:s.couponData.min_buy_price_by_price,"onUpdate:modelValue":t[14]||(t[14]=a=>s.couponData.min_buy_price_by_price=a),modelModifiers:{number:!0},disabled:s.couponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),c(f,{name:"金額",class:"invalid-feedback"})]),e("p",Ie,[s.couponData.title==="金額折抵"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("折抵金額 NT$ ")]),e("div",null,[c(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"折抵金額",rules:s.couponData.title==="金額折抵"?"required|compareWithPrice:@金額":"",class:_(["form-control",{"is-invalid":n.折抵金額}]),placeholder:"設定金額",modelValue:s.couponData.discount_price,"onUpdate:modelValue":t[15]||(t[15]=a=>s.couponData.discount_price=a),modelModifiers:{number:!0},disabled:s.couponData.title==="訂單折扣"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),c(f,{name:"折抵金額",class:"invalid-feedback"})])])]),e("div",We,[P(e("input",{class:"form-check-input",type:"radio",id:"flexRadioDefault2",value:"訂單折扣","onUpdate:modelValue":t[16]||(t[16]=a=>s.couponData.title=a)},null,512),[[M,s.couponData.title]]),Ye,e("div",Ae,[e("p",Ee,[s.couponData.title==="訂單折扣"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("消費滿 NT$ ")]),e("div",null,[c(g,{type:"number",onKeydown:l.preventKeydownSpecialKey,onPaste:l.preventPasteSpecialKey,name:"消費金額",rules:{required:s.couponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.消費金額}]),placeholder:"設定金額",modelValue:s.couponData.min_buy_price_by_discount,"onUpdate:modelValue":t[17]||(t[17]=a=>s.couponData.min_buy_price_by_discount=a),modelModifiers:{number:!0},disabled:s.couponData.title==="金額折抵"},null,8,["onKeydown","onPaste","rules","class","modelValue","disabled"]),c(f,{name:"消費金額",class:"invalid-feedback"})]),e("p",He,[s.couponData.title==="訂單折扣"?(i(),d(y,{key:0},[r("*")],64)):p("",!0),r("折扣 ")]),e("div",null,[c(g,{as:"select",name:"折扣",rules:{required:s.couponData.title==="訂單折扣"},class:_(["form-control",{"is-invalid":n.折扣}]),placeholder:"請選擇折扣",modelValue:s.couponData.percent,"onUpdate:modelValue":t[18]||(t[18]=a=>s.couponData.percent=a),disabled:s.couponData.title==="金額折抵"},{default:v(()=>[Je,(i(!0),d(y,null,K(l.discountsOption,a=>(i(),d("option",{key:a[0],value:a[1]},h(a[0]),9,Oe))),128))]),_:2},1032,["rules","class","modelValue","disabled"]),c(f,{name:"折扣",class:"invalid-feedback"})])])])]),e("div",Qe,[Xe,c(g,{name:"日期",modelValue:s.couponData.dates,"onUpdate:modelValue":t[20]||(t[20]=a=>s.couponData.dates=a),rules:"required"},{default:v(()=>[c(T,{modelValue:s.couponData.dates,"onUpdate:modelValue":t[19]||(t[19]=a=>s.couponData.dates=a),"input-class-name":"border-0",class:_(["dp-custom form-control py-0 ps-0 pe-9",{"is-invalid":n.日期}]),"model-type":"timestamp",range:{partialRange:!1},format:l.format,"enable-time-picker":!1,locale:"zh-TW",cancelText:"取消",selectText:"選擇",onBlur:l.blurValidate},null,8,["modelValue","class","format","onBlur"])]),_:2},1032,["modelValue"]),c(f,{name:"日期",class:"invalid-feedback"})])]))]),e("div",Ze,[e("button",{type:"button",class:"btn btn-outline-primary border-1",disabled:u.loadingStatus.loadingGetCoupon,onClick:t[21]||(t[21]=(...a)=>l.closeModal&&l.closeModal(...a))}," 取消 ",8,$e),e("button",{type:"submit",class:"btn btn-primary",disabled:u.loadingStatus.loadingGetCoupon||!x.valid}," 確定 ",8,et)])]),_:1},8,["onSubmit"]))])],512)}const st=L(E,[["render",tt],["__scopeId","data-v-450a39c5"]]),ot={props:["copyContent","type"],methods:{...W(Y,["copyTextMethod"]),copyText(){this.copyTextMethod(this.copyContent,this.type)}}},nt=e("i",{class:"bi bi-copy"},null,-1),lt=[nt];function at(o,t,u,m,s,l){return i(),d("a",{href:"#",class:"ms-1",onClick:t[0]||(t[0]=C((...g)=>l.copyText&&l.copyText(...g),["prevent"]))},lt)}const it=L(ot,[["render",at]]),U="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%23198754'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm-2%2015-5-5%201.41-1.41L10%2014.17l7.59-7.59L19%208l-9%209z'/%3e%3c/svg%3e",N="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%23dc3545'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.47%202%202%206.47%202%2012s4.47%2010%2010%2010%2010-4.47%2010-10S17.53%202%2012%202zm5%2013.59L15.59%2017%2012%2013.41%208.41%2017%207%2015.59%2010.59%2012%207%208.41%208.41%207%2012%2010.59%2015.59%207%2017%208.41%2013.41%2012%2017%2015.59z'/%3e%3c/svg%3e",G="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='18px'%20viewBox='0%200%2024%2024'%20width='18px'%20fill='%239f9f9f'%3e%3cpath%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%202C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm5%2011H7v-2h10v2z'/%3e%3c/svg%3e",dt={data(){return{currentTab:"所有優惠券",currentPageCoupons:[],currentPage:1,coupons:[],validCoupons:[],notYetValidCoupons:[],InvalidCoupons:[],coupon:{},newCoupon:{title:"金額折抵"},isNew:!0,isLoading:!1,loadingStatus:{loadingGetCoupons:!1,loadingGetCoupon:!1,loadingDelCoupon:""}}},components:{AdCouponModal:st,CopyText:it},methods:{async getCoupons(){try{this.loadingStatus.loadingGetCoupons=!0,this.coupons=[],this.validCoupons=[],this.InvalidCoupons=[],this.notYetValidCoupons=[],this.currentPageCoupons=[];let o,t;const u="https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupons",m=await this.$http.get(u);for(this.coupons=m.data.coupons,o=m.data.pagination.current_page+1,t=m.data.pagination.total_pages;o<=t;){const s=await this.$http.get(`${u}?page=${o}`);this.coupons=[...this.coupons,...s.data.coupons],o++}this.filterCoupons(),this.changePage(this.currentPage)}catch(o){V(o.response.data.message)}finally{this.loadingStatus.loadingGetCoupons=!1}},filterCoupons(){this.coupons.forEach(o=>{D("now")>o.start_date&&D("now")<o.due_date?this.validCoupons.push(o):D("now")>o.due_date?this.InvalidCoupons.push(o):D("now")<o.start_date&&this.notYetValidCoupons.push(o)})},changePage(o){switch(this.currentTab){case"所有優惠券":this.currentPageCoupons=this.coupons.slice((o-1)*10,o*10);break;case"有效":this.currentPageCoupons=this.validCoupons.slice((o-1)*10,o*10);break;case"尚未生效":this.currentPageCoupons=this.notYetValidCoupons.slice((o-1)*10,o*10);break;case"已失效":this.currentPageCoupons=this.InvalidCoupons.slice((o-1)*10,o*10);break}A()},changeTab(o){this.currentTab=o,this.currentPage=1,this.changePage(this.currentPage)},async getCoupon(o){try{this.loadingStatus.loadingGetCoupon=!0;const u=await this.$http.get("https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupons");this.coupon=u.data.coupons.find(m=>m.id===o),this.loadingStatus.loadingGetCoupon=!1}catch(t){V(t.response.data.message)}finally{this.loadingStatus.loadingGetCoupon=!1}},updateCoupon(o){this.loadingStatus.loadingGetCoupon=!0;const t={title:o.title,is_enabled:1,percent:o.title==="金額折抵"?100:o.percent,start_date:o.dates[0]/1e3,due_date:o.dates[1]/1e3,code:o.code};if(o.title==="金額折抵"?(t.min_buy_price_by_price=o.min_buy_price_by_price,t.discount_price=o.discount_price,t.min_buy_price_by_discount=""):o.title==="訂單折扣"&&(t.min_buy_price_by_discount=o.min_buy_price_by_discount,t.min_buy_price_by_price="",t.discount_price=""),this.isNew)this.$http.post("https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupon",{data:t}).then(m=>{F(m.data.message),this.$refs.adCouponModal.closeModal(),this.getCoupons()}).catch(m=>{V(m.response.data.message)}).finally(()=>{this.loadingStatus.loadingGetCoupon=!1});else if(!this.isNew){const m=`https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupon/${o.id}`;this.$http.put(m,{data:t}).then(s=>{F(s.data.message),this.$refs.adCouponModal.closeModal(),this.getCoupons()}).catch(s=>{V(s.response.data.message)}).finally(()=>{this.loadingStatus.loadingGetCoupon=!1})}},deleteCoupon(o){this.loadingStatus.loadingDelCoupon=o;const t=`https://ec-course-api.hexschool.io/v2/api/greensheep/admin/coupon/${o}`;this.$http.delete(t).then(u=>{F(u.data.message),this.getCoupons()}).catch(u=>{V(u.response.data.message)}).finally(()=>{this.loadingStatus.loadingDelCoupon=""})},async openModal(o,t){switch(o){case"new":this.$refs.adCouponModal.reset(),this.isNew=!0,this.$refs.adCouponModal.resetNewCoupon(),this.$refs.adCouponModal.openModal();break;case"edit":this.isNew=!1,this.$refs.adCouponModal.openModal(),await this.getCoupon(t);break}},unixToDate(o){const t=o*1e3;return B(t)},dateToUnix(o="now"){return D(o)}},mounted(){this.getCoupons()}},ct={class:"ad-coupon px-lg-10 pt-3 pt-lg-10 text-start"},rt=e("h1",{class:"fs-3 mb-4 fw-bold"},"優惠管理",-1),ut={class:"nav flex-nowrap text-nowrap overflow-x-scroll overflow-x-sm-auto border-bottom border-primary mb-4"},pt={class:"nav-item"},_t={class:"nav-item"},mt={class:"nav-item"},ht={class:"nav-item"},bt={class:"table-container table-responsive d-none d-lg-block"},gt={class:"table align-middle text-nowrap mb-4"},ft=e("thead",{class:"table-head position-relative"},[e("tr",null,[e("th",{style:{width:"15%"}},"優惠碼"),e("th",{style:{width:"30%"}},"優惠型式"),e("th",{style:{width:"15%"}},"開始日期"),e("th",{style:{width:"15%"}},"結束日期"),e("th",{style:{width:"15%"}},"狀態"),e("th",{style:{width:"5%"}}),e("th",{style:{width:"5%"}})])],-1),yt={class:"py-5"},vt={class:"fw-bold mb-4"},Ct={key:0},wt={key:1},xt={key:0,class:"text-success"},kt=e("img",{src:U,alt:"有效",class:"align-top"},null,-1),Dt={key:1,class:"text-danger"},Vt=e("img",{src:N,alt:"已失效",class:"align-top"},null,-1),Tt={key:2},St=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),Pt={key:1,class:"text-success"},Mt=e("img",{src:U,alt:"有效",class:"align-top"},null,-1),Kt={key:2},Ut=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),Nt={key:3,class:"text-danger"},Gt=e("img",{src:N,alt:"已失效",class:"align-top"},null,-1),Ft=["onClick"],Lt=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),qt=[Lt],zt={class:"d-flex align-items-center"},Bt=["onClick"],Rt=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),jt=[Rt],It={key:0,class:"spinner-border spinner-border-sm",role:"status"},Wt=e("span",{class:"visually-hidden"},"Loading...",-1),Yt=[Wt],At={class:"row list-unstyled text-dark d-lg-none",style:{"row-gap":"12px"}},Et={class:"border border-primary rounded overflow-hidden"},Ht={class:"row g-0"},Jt={class:"col-12"},Ot={class:"bg-primary d-flex justify-content-between align-items-center px-2 py-2"},Qt={class:"bg-primary text-white fw-bold"},Xt={class:"text-end bg-white rounded-pill px-2 py-1 fs-8"},Zt={key:0,class:"text-success"},$t=e("img",{src:U,alt:"有效",class:"align-top"},null,-1),es={key:1,class:"text-danger"},ts=e("img",{src:N,alt:"已失效",class:"align-top"},null,-1),ss={key:2},os=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),ns={key:1,class:"text-success"},ls=e("img",{src:U,alt:"有效",class:"align-top"},null,-1),as={key:2},is=e("img",{src:G,alt:"已失效",class:"align-top"},null,-1),ds={key:3,class:"text-danger"},cs=e("img",{src:N,alt:"已失效",class:"align-top"},null,-1),rs={class:"col-12"},us={class:"px-2 py-2 border-bottom border-primary"},ps={class:"fw-bold mb-2"},_s={key:0},ms={key:1},hs={class:"col-9"},bs={class:"px-2 py-2"},gs={class:"col-3"},fs={class:"d-flex justify-content-between justify-content-sm-evenly pe-4 py-2"},ys=["onClick"],vs=e("i",{class:"bi bi-pencil-fill text-dark fs-6"},null,-1),Cs=[vs],ws=["onClick"],xs=e("i",{class:"bi bi-trash3-fill text-dark fs-6"},null,-1),ks={key:0,class:"spinner-border spinner-border-sm",role:"status"},Ds=e("span",{class:"visually-hidden"},"Loading...",-1),Vs=[Ds],Ts={class:"text-center va-pagination"},Ss=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Ps=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Ms=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Ks=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Us=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Ns=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Gs=e("span",{class:"material-icons fs-8 p-1"}," navigate_before ",-1),Fs=e("span",{class:"material-icons fs-8 p-1"}," navigate_next ",-1),Ls={key:0,class:"d-flex justify-content-center align-items-center",style:{"min-height":"360px"}},qs=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),zs=[qs];function Bs(o,t,u,m,s,l){const g=w("CopyText"),f=w("vue-awesome-paginate"),T=w("VueLoading"),S=w("AdCouponModal");return i(),d(y,null,[e("div",ct,[rt,e("ul",ut,[e("li",pt,[e("a",{class:_(["nav-link px-6 py-4",{active:s.currentTab==="所有優惠券"}]),href:"#",onClick:t[0]||(t[0]=C(n=>l.changeTab("所有優惠券"),["prevent"]))}," 所有優惠券 ",2)]),e("li",_t,[e("a",{class:_(["nav-link px-6 py-4",{active:s.currentTab==="有效"}]),href:"#",onClick:t[1]||(t[1]=C(n=>l.changeTab("有效"),["prevent"]))}," 有效 ",2)]),e("li",mt,[e("a",{class:_(["nav-link px-6 py-4",{active:s.currentTab==="尚未生效"}]),href:"#",onClick:t[2]||(t[2]=C(n=>l.changeTab("尚未生效"),["prevent"]))}," 尚未生效 ",2)]),e("li",ht,[e("a",{class:_(["nav-link px-6 py-4",{active:s.currentTab==="已失效"}]),href:"#",onClick:t[3]||(t[3]=C(n=>l.changeTab("已失效"),["prevent"]))}," 已失效 ",2)])]),e("a",{href:"#",class:"btn btn-primary mb-4",onClick:t[4]||(t[4]=C(n=>l.openModal("new"),["prevent"]))},"新增優惠券"),e("div",bt,[e("table",gt,[ft,e("tbody",null,[(i(!0),d(y,null,K(s.currentPageCoupons,n=>(i(),d("tr",{key:n.id},[e("td",null,[r(h(n.code)+" ",1),c(g,{copyContent:n.code,type:"優惠碼"},null,8,["copyContent"])]),e("td",yt,[e("p",vt,h(n.title),1),n.title==="金額折抵"?(i(),d("p",Ct," 消費滿 NT$ "+h(n.min_buy_price_by_price)+"，享 NT$ "+h(n.discount_price)+" 折扣 ",1)):p("",!0),n.title==="訂單折扣"?(i(),d("p",wt," 消費滿 NT$ "+h(n.min_buy_price_by_discount)+"，享 "+h(n.percent%10?n.percent:n.percent/10)+" 折 ",1)):p("",!0)]),e("td",null,h(l.unixToDate(n.start_date)),1),e("td",null,h(l.unixToDate(n.due_date)),1),e("td",null,[s.currentTab==="所有優惠券"?(i(),d(y,{key:0},[l.dateToUnix()>n.start_date&&l.dateToUnix()<n.due_date?(i(),d("span",xt,[r(" 有效 "),kt])):p("",!0),l.dateToUnix()>n.due_date?(i(),d("span",Dt,[r(" 已失效 "),Vt])):p("",!0),l.dateToUnix()<n.start_date?(i(),d("span",Tt,[r(" 尚未生效 "),St])):p("",!0)],64)):s.currentTab==="有效"?(i(),d("span",Pt,[r(" 有效 "),Mt])):s.currentTab==="尚未生效"?(i(),d("span",Kt,[r(" 尚未生效 "),Ut])):s.currentTab==="已失效"?(i(),d("span",Nt,[r(" 已失效 "),Gt])):p("",!0)]),e("td",null,[e("a",{href:"#",class:_({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:C(x=>l.openModal("edit",n.id),["prevent"])},qt,10,Ft)]),e("td",null,[e("div",zt,[e("a",{href:"#",class:_({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:C(x=>l.deleteCoupon(n.id),["prevent"])},jt,10,Bt),s.loadingStatus.loadingDelCoupon===n.id?(i(),d("div",It,Yt)):p("",!0)])])]))),128))])])]),e("ul",At,[(i(!0),d(y,null,K(s.currentPageCoupons,n=>(i(),d("li",{class:"col-12",key:n.id},[e("div",Et,[e("div",Ht,[e("div",Jt,[e("div",Ot,[e("div",Qt,[r(h(n.code)+" ",1),c(g,{copyContent:n.code,type:"優惠碼"},null,8,["copyContent"])]),e("div",Xt,[s.currentTab==="所有優惠券"?(i(),d(y,{key:0},[l.dateToUnix()>n.start_date&&l.dateToUnix()<n.due_date?(i(),d("span",Zt,[r(" 有效 "),$t])):p("",!0),l.dateToUnix()>n.due_date?(i(),d("span",es,[r(" 已失效 "),ts])):p("",!0),l.dateToUnix()<n.start_date?(i(),d("span",ss,[r(" 尚未生效 "),os])):p("",!0)],64)):s.currentTab==="有效"?(i(),d("span",ns,[r(" 有效 "),ls])):s.currentTab==="尚未生效"?(i(),d("span",as,[r(" 尚未生效 "),is])):s.currentTab==="已失效"?(i(),d("span",ds,[r(" 已失效 "),cs])):p("",!0)])])]),e("div",rs,[e("div",us,[e("p",ps,h(n.title),1),n.title==="金額折抵"?(i(),d("p",_s," 消費滿 NT$ "+h(n.min_buy_price_by_price)+"，享 NT$ "+h(n.discount_price)+" 折扣 ",1)):p("",!0),n.title==="訂單折扣"?(i(),d("p",ms," 消費滿 NT$ "+h(n.min_buy_price_by_discount)+"，享 "+h(n.percent%10?n.percent:n.percent/10)+" 折 ",1)):p("",!0)])]),e("div",hs,[e("p",bs,h(l.unixToDate(n.start_date))+" 至 "+h(l.unixToDate(n.due_date)),1)]),e("div",gs,[e("div",fs,[e("a",{href:"#",class:_({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:C(x=>l.openModal("edit",n.id),["prevent"])},Cs,10,ys),e("a",{href:"#",class:_({"disabled-link":s.loadingStatus.loadingDelCoupon}),onClick:C(x=>l.deleteCoupon(n.id),["prevent"])},[xs,s.loadingStatus.loadingDelCoupon===n.id?(i(),d("div",ks,Vs)):p("",!0)],10,ws)])])])])]))),128))]),e("div",Ts,[s.currentTab==="所有優惠券"&&!s.loadingStatus.loadingGetCoupons?(i(),k(f,{key:0,"total-items":s.coupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[5]||(t[5]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":v(()=>[Ss]),"next-button":v(()=>[Ps]),_:1},8,["total-items","modelValue","onClick"])):s.currentTab==="有效"&&!s.loadingStatus.loadingGetCoupons?(i(),k(f,{key:1,"total-items":s.validCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[6]||(t[6]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":v(()=>[Ms]),"next-button":v(()=>[Ks]),_:1},8,["total-items","modelValue","onClick"])):s.currentTab==="尚未生效"&&!s.loadingStatus.loadingGetCoupons?(i(),k(f,{key:2,"total-items":s.notYetValidCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[7]||(t[7]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":v(()=>[Us]),"next-button":v(()=>[Ns]),_:1},8,["total-items","modelValue","onClick"])):s.currentTab==="已失效"&&!s.loadingStatus.loadingGetCoupons?(i(),k(f,{key:3,"total-items":s.InvalidCoupons.length,"items-per-page":10,"max-pages-shown":3,modelValue:s.currentPage,"onUpdate:modelValue":t[8]||(t[8]=n=>s.currentPage=n),onClick:l.changePage,"pagination-container-class":"cus-pagination","paginate-buttons-class":"page-link","number-buttons-class":"fs-8","active-page-class":"active"},{"prev-button":v(()=>[Gs]),"next-button":v(()=>[Fs]),_:1},8,["total-items","modelValue","onClick"])):p("",!0)]),s.loadingStatus.loadingGetCoupons?(i(),d("div",Ls,zs)):p("",!0)]),c(T,{active:s.isLoading},null,8,["active"]),c(S,{ref:"adCouponModal",coupon:s.coupon,newCoupon:s.newCoupon,isNew:s.isNew,loadingStatus:s.loadingStatus,onUpdateCoupon:l.updateCoupon},null,8,["coupon","newCoupon","isNew","loadingStatus","onUpdateCoupon"])],64)}const Js=L(dt,[["render",Bs]]);export{Js as default};
