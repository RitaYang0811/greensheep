import{y as O,z as a,_ as b,m as f,a as P,c as h,b as o,t as c,F as T,r as w,o as p,e as x}from"./index-Dr79K2c5.js";import{S as u}from"./sweetalert2.all-BSRyfVnl.js";import{l as y}from"./lineNotifyStore-BsTY6Nw1.js";var C={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"greensheep",VITE_LINE_CLIENT_ID:"x9iTcS6m9Fdlz8XFfAbkqs",VITE_LINE_REDIRECT_URI:"http://localhost:5173/greensheep/#/admin/home",VITE_LINE_CLIENT_SECRET:"iGiOLRLmU2aNTDuObVQlcP5XzPYSbUzJ9gvUl4YvPzx",BASE_URL:"/greensheep/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:l,VITE_APP_API_NAME:i}=C,_=O("orderStore",{state:()=>({allOrders:[],unpaidOrders:[],paidOrders:[],deletedOrders:[],doneOrders:[]}),actions:{async getAllOrders(){try{this.allOrders=[],this.unpaidOrders=[],this.paidOrders=[];const t=`${l}/api/${i}/admin/orders`,s=await a.get(t);this.allOrders=s.data.orders,this.allOrders.forEach(e=>{e.orderStatus||(e.orderStatus={getOrder:!0,making:!1,sendProduct:!1,done:!1}),e.is_deleted?this.deletedOrders.push(e):e.is_paid?this.paidOrders.push(e):this.unpaidOrders.push(e),e.orderStatus.done&&this.doneOrders.push(e)})}catch(t){console.log(t)}},updateOrder(t){const s=`${l}/api/${i}/admin/order/${t.id}`;t.orderStatus=this.orderStatus,a.put(s,{data:t}).then(()=>{u.fire({position:"top-end",icon:"success",title:"訂單修改成功",showConfirmButton:!1,toast:!0,timer:1500}),location.reload()}).catch(e=>{console.log(e)})},deleteOrder(t){const s=`${l}/api/${i}/admin/order/${t.id}`;u.fire({title:"是否刪除該訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(e=>{e.isConfirmed&&(console.log("delete"),t.is_deleted=!0,a.put(s,{data:t}).then(r=>{console.log(r),location.reload()}).catch(r=>{console.log(r)}))}),console.log(t)},recoverDelete(t){const s=`${l}/api/${i}/admin/order/${t.id}`;t.is_deleted=!1,a.put(s,{data:t}).then(e=>{console.log(e),location.reload(),console.log("Rocover Delete")}).catch(e=>{console.log(e)})},confirmDelete(t){const s=`${l}/api/${i}/admin/order/${t}`;u.fire({title:"確認永久刪除該訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(e=>{e.isConfirmed&&a.delete(s).then(()=>{location.reload()}).catch(r=>{console.log(r)})})},deleteAllOrders(){const t=`${l}/api/${i}/admin/orders/all`;u.fire({title:"確認永久刪除全部訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(s=>{s.isConfirmed&&a.delete(t).then(()=>{location.reload()}).catch(e=>{console.log(e)})})}}}),E={data(){return{orderCreateTime:null,passedTime:null,homeOrderInfo:[]}},methods:{...f(_,["getAllOrders","getNewOrders"]),...f(y,["lineGetOrder","lineGetAccessToken","sendLineNotification"]),toOrderPage(){this.$router.push("/admin/orders")},getHomeOrders(){console.log("3",this.allOrders,this.unpaidOrders);const t=Math.floor(new Date().getTime()/1e3);console.log(t);const s=this.unpaidOrders.map(e=>({id:e.create_at,createTime:e.create_at,passedTime:this.calculatePassedTime(t,e.create_at)}));this.homeOrderInfo=s},calculatePassedTime(t,s){const e=t-s;if(e<60)return e+"秒前";if(e>=60&&e<60*60)return Math.floor(e/60)+"分鐘前";if(e>=60*60&&e<24*60*60)return Math.floor(e/3600)+"小時前";{const r=Math.floor(e/86400),m=Math.floor(e%(24*60*60)/(60*60));return r+"天"+m+"小時前"}},getLineCode(){const s=new URLSearchParams(window.location.search).get("code");s?this.lineGetAccessToken(s):console.error("未獲取到授權碼")}},computed:{...P(_,["allOrders","unpaidOrders","paidOrders","deletedOrders","doneOrders"])},async mounted(){await this.getAllOrders(),this.getHomeOrders(),this.getLineCode()}},I={class:"container px-3 px-lg-10 mt-8 mt-lg-10 mb-7 mb-lg-10"},v={class:"row"},A={class:"col-12 col-lg-5 mb-9"},B=o("h1",{class:"display-3 fw-bold mb-4 text-start"},"待辦清單",-1),S={class:"d-flex"},k={class:"w-50 bg-white m-2"},L={class:"py-8"},U={class:"d-block fs-2 mb-3 text-primary fw-medium"},$=o("span",{class:"d-block fs-6 mb-3 text-primary"},"全部訂單",-1),N={class:"w-50 bg-white m-2"},R={class:"py-8"},V={class:"d-block fs-2 mb-3 text-primary fw-medium"},D=o("span",{class:"d-block fs-6 mb-3 text-primary"},"待付款訂單",-1),G={class:"col-12 col-lg-7"},M=o("h2",{class:"display-3 fw-bold mb-4 text-start"},"通知",-1),z={class:"d-flex"},F={class:"notice-board w-100 bg-white m-2"},H={class:"p-3"},X={class:"card-body p-3 text-start cursor-pointer"},Y={class:"fs-6 text-dark fw-medium font-notosans mb-3"},q=o("span",{class:"float-end"},[o("i",{class:"bi bi-exclamation-circle-fill text-danger"})],-1),J={class:"fs-7 text-primary"};function Q(t,s,e,r,m,d){return p(),h("div",I,[o("div",v,[o("div",A,[B,o("div",S,[o("div",k,[o("div",L,[o("span",U,c(t.allOrders.length),1),$]),o("button",{type:"button ",class:"custom-btn custom-btn-toGreen w-100",onClick:s[0]||(s[0]=(...n)=>d.toOrderPage&&d.toOrderPage(...n))}," 查看詳情 ")]),o("div",N,[o("div",R,[o("span",V,c(t.unpaidOrders.length),1),D]),o("button",{type:"button ",class:"custom-btn custom-btn-toGreen w-100",onClick:s[1]||(s[1]=(...n)=>d.toOrderPage&&d.toOrderPage(...n))}," 查看詳情 ")])])]),o("div",G,[M,o("button",{type:"button",class:"btn btn-primary my-3",onClick:s[2]||(s[2]=(...n)=>t.lineGetOrder&&t.lineGetOrder(...n))}," 管理員綁定新訂單通知 "),o("div",z,[o("div",F,[o("div",H,[(p(!0),h(T,null,w(m.homeOrderInfo,n=>(p(),h("div",{key:n.id,class:"card border border-primary rounded-3 mb-4",onClick:s[3]||(s[3]=(...g)=>d.toOrderPage&&d.toOrderPage(...g))},[o("div",X,[o("div",Y,[x(" 訂單編號："+c(n.id)+" ",1),q]),o("p",J," 恭喜你！"+c(n.passedTime)+" 收到一筆新訂單喔！ ",1)])]))),128))])])])])])])}const Z=b(E,[["render",Q]]);export{Z as default};
