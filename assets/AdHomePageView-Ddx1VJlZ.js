import{y as g,z as a,_ as b,m as f,a as P,c as h,b as s,t as c,F as T,r as w,o as p,e as x}from"./index-BR5KV5qp.js";import{S as u}from"./sweetalert2.all-Cz3UGc0C.js";import{l as y}from"./lineNotifyStore-DHK51iQO.js";var v={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"greensheep",VITE_LINE_CLIENT_ID:"x9iTcS6m9Fdlz8XFfAbkqs",VITE_LINE_CLIENT_SECRET:"iGiOLRLmU2aNTDuObVQlcP5XzPYSbUzJ9gvUl4YvPzx",BASE_URL:"/greensheep/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:l,VITE_APP_API_NAME:i}=v,_=g("orderStore",{state:()=>({allOrders:[],unpaidOrders:[],paidOrders:[],deletedOrders:[],doneOrders:[]}),actions:{async getAllOrders(){try{this.allOrders=[],this.unpaidOrders=[],this.paidOrders=[];const t=`${l}/api/${i}/admin/orders`,o=await a.get(t);this.allOrders=o.data.orders,this.allOrders.forEach(e=>{e.orderStatus||(e.orderStatus={getOrder:!0,making:!1,sendProduct:!1,done:!1}),e.is_deleted?this.deletedOrders.push(e):e.is_paid?this.paidOrders.push(e):this.unpaidOrders.push(e),e.orderStatus.done&&this.doneOrders.push(e)})}catch(t){console.log(t)}},updateOrder(t){const o=`${l}/api/${i}/admin/order/${t.id}`;t.orderStatus=this.orderStatus,a.put(o,{data:t}).then(()=>{u.fire({position:"top-end",icon:"success",title:"訂單修改成功",showConfirmButton:!1,toast:!0,timer:1500}),location.reload()}).catch(e=>{console.log(e)})},deleteOrder(t){const o=`${l}/api/${i}/admin/order/${t.id}`;u.fire({title:"是否刪除該訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(e=>{e.isConfirmed&&(console.log("delete"),t.is_deleted=!0,a.put(o,{data:t}).then(r=>{console.log(r),location.reload()}).catch(r=>{console.log(r)}))}),console.log(t)},recoverDelete(t){const o=`${l}/api/${i}/admin/order/${t.id}`;t.is_deleted=!1,a.put(o,{data:t}).then(e=>{console.log(e),location.reload(),console.log("Rocover Delete")}).catch(e=>{console.log(e)})},confirmDelete(t){const o=`${l}/api/${i}/admin/order/${t}`;u.fire({title:"確認永久刪除該訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(e=>{e.isConfirmed&&a.delete(o).then(()=>{location.reload()}).catch(r=>{console.log(r)})})},deleteAllOrders(){const t=`${l}/api/${i}/admin/orders/all`;u.fire({title:"確認永久刪除全部訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(o=>{o.isConfirmed&&a.delete(t).then(()=>{location.reload()}).catch(e=>{console.log(e)})})}}}),C={data(){return{orderCreateTime:null,passedTime:null,homeOrderInfo:[]}},methods:{...f(_,["getAllOrders","getNewOrders"]),...f(y,["lineGetOrder"]),toOrderPage(){this.$router.push("/admin/orders")},getHomeOrders(){const t=Math.floor(new Date().getTime()/1e3),o=this.unpaidOrders.map(e=>({id:e.create_at,createTime:e.create_at,passedTime:this.calculatePassedTime(t,e.create_at)}));this.homeOrderInfo=o},calculatePassedTime(t,o){const e=t-o;if(e<60)return e+"秒前";if(e>=60&&e<60*60)return Math.floor(e/60)+"分鐘前";if(e>=60*60&&e<24*60*60)return Math.floor(e/3600)+"小時前";{const r=Math.floor(e/86400),m=Math.floor(e%(24*60*60)/(60*60));return r+"天"+m+"小時前"}}},computed:{...P(_,["allOrders","unpaidOrders","paidOrders","deletedOrders","doneOrders"])},async mounted(){await this.getAllOrders(),this.getHomeOrders()}},B={class:"container px-3 px-lg-10 mt-8 mt-lg-10 mb-7 mb-lg-10"},A={class:"row"},E={class:"col-12 col-lg-5 mb-9"},I=s("h1",{class:"display-3 fw-bold mb-4 text-start"},"待辦清單",-1),S={class:"d-flex"},k={class:"w-50 bg-white m-2"},$={class:"py-8"},U={class:"d-block fs-2 mb-3 text-primary fw-medium"},N=s("span",{class:"d-block fs-6 mb-3 text-primary"},"全部訂單",-1),V={class:"w-50 bg-white m-2"},D={class:"py-8"},L={class:"d-block fs-2 mb-3 text-primary fw-medium"},M=s("span",{class:"d-block fs-6 mb-3 text-primary"},"待付款訂單",-1),R={class:"col-12 col-lg-7"},G=s("h2",{class:"display-3 fw-bold mb-4 text-start"},"通知",-1),z={class:"d-flex"},F={class:"notice-board w-100 bg-white m-2"},H={class:"p-3"},X={class:"card-body p-3 text-start cursor-pointer"},Y={class:"fs-6 text-dark fw-medium font-notosans mb-3"},q=s("span",{class:"float-end"},[s("i",{class:"bi bi-exclamation-circle-fill text-danger"})],-1),J={class:"fs-7 text-primary"};function Q(t,o,e,r,m,n){return p(),h("div",B,[s("div",A,[s("div",E,[I,s("div",S,[s("div",k,[s("div",$,[s("span",U,c(t.allOrders.length),1),N]),s("button",{type:"button ",class:"custom-btn custom-btn-toGreen w-100",onClick:o[0]||(o[0]=(...d)=>n.toOrderPage&&n.toOrderPage(...d))}," 查看詳情 ")]),s("div",V,[s("div",D,[s("span",L,c(t.unpaidOrders.length),1),M]),s("button",{type:"button ",class:"custom-btn custom-btn-toGreen w-100",onClick:o[1]||(o[1]=(...d)=>n.toOrderPage&&n.toOrderPage(...d))}," 查看詳情 ")])])]),s("div",R,[G,s("button",{type:"button",class:"btn btn-primary my-3",onClick:o[2]||(o[2]=(...d)=>t.lineGetOrder&&t.lineGetOrder(...d))}," 管理員綁定新訂單通知 "),s("div",z,[s("div",F,[s("div",H,[(p(!0),h(T,null,w(m.homeOrderInfo,d=>(p(),h("div",{key:d.id,class:"card border border-primary rounded-3 mb-4",onClick:o[3]||(o[3]=(...O)=>n.toOrderPage&&n.toOrderPage(...O))},[s("div",X,[s("div",Y,[x(" 訂單編號："+c(d.id)+" ",1),q]),s("p",J," 恭喜你！"+c(d.passedTime)+" 收到一筆新訂單喔！ ",1)])]))),128))])])])])])])}const Z=b(C,[["render",Q]]);export{Z as default};
