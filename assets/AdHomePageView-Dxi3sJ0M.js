import{y as b,C as n,_ as g,m as f,a as P,c as h,b as s,t as c,F as T,r as w,o as p,e as x}from"./index-BnI40pZa.js";import{S as u}from"./sweetalert2.all-CnuW5dCa.js";import{l as y}from"./lineNotifyStore-CgIkUMu9.js";var C={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"greensheep",VITE_LINE_CLIENT_ID:"x9iTcS6m9Fdlz8XFfAbkqs",VITE_LINE_CLIENT_SECRET:"iGiOLRLmU2aNTDuObVQlcP5XzPYSbUzJ9gvUl4YvPzx",BASE_URL:"/greensheep/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:i,VITE_APP_API_NAME:l}=C,_=b("orderStore",{state:()=>({allOrders:[],unpaidOrders:[],paidOrders:[],deletedOrders:[],doneOrders:[]}),actions:{async getAllOrders(){try{this.allOrders=[],this.unpaidOrders=[],this.paidOrders=[];const t=`${i}/api/${l}/admin/orders`,r=await n.get(t);this.allOrders=r.data.orders,this.allOrders.forEach(e=>{e.orderStatus||(e.orderStatus={getOrder:!0,making:!1,sendProduct:!1,done:!1}),e.is_deleted?this.deletedOrders.push(e):e.is_paid?this.paidOrders.push(e):this.unpaidOrders.push(e),e.orderStatus.done&&this.doneOrders.push(e)})}catch(t){console.log(t)}},updateOrder(t){const r=`${i}/api/${l}/admin/order/${t.id}`;t.orderStatus=this.orderStatus,n.put(r,{data:t}).then(()=>{u.fire({position:"top-end",icon:"success",title:"訂單修改成功",showConfirmButton:!1,toast:!0,timer:1500}),location.reload()}).catch(e=>{console.log(e)})},deleteOrder(t){const r=`${i}/api/${l}/admin/order/${t.id}`;u.fire({title:"是否刪除該訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(e=>{e.isConfirmed&&(t.is_deleted=!0,n.put(r,{data:t}).then(()=>{location.reload()}).catch(d=>{console.log(d)}))})},recoverDelete(t){const r=`${i}/api/${l}/admin/order/${t.id}`;t.is_deleted=!1,n.put(r,{data:t}).then(()=>{location.reload()}).catch(e=>{console.log(e)})},confirmDelete(t){const r=`${i}/api/${l}/admin/order/${t}`;u.fire({title:"確認永久刪除該訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(e=>{e.isConfirmed&&n.delete(r).then(()=>{location.reload()}).catch(d=>{console.log(d)})})},deleteAllOrders(){const t=`${i}/api/${l}/admin/orders/all`;u.fire({title:"確認永久刪除全部訂單?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#566b5a",cancelButtonText:"  否  ",confirmButtonText:"  是  "}).then(r=>{r.isConfirmed&&n.delete(t).then(()=>{location.reload()}).catch(e=>{console.log(e)})})}}}),v={data(){return{orderCreateTime:null,passedTime:null,homeOrderInfo:[]}},methods:{...f(_,["getAllOrders","getNewOrders"]),...f(y,["lineGetOrder"]),toOrderPage(){this.$router.push("/admin/orders")},getHomeOrders(){const t=Math.floor(new Date().getTime()/1e3),r=this.unpaidOrders.map(e=>({id:e.create_at,createTime:e.create_at,passedTime:this.calculatePassedTime(t,e.create_at)}));this.homeOrderInfo=r},calculatePassedTime(t,r){const e=t-r;if(e<60)return e+"秒前";if(e>=60&&e<60*60)return Math.floor(e/60)+"分鐘前";if(e>=60*60&&e<24*60*60)return Math.floor(e/3600)+"小時前";{const d=Math.floor(e/86400),m=Math.floor(e%(24*60*60)/(60*60));return d+"天"+m+"小時前"}}},computed:{...P(_,["allOrders","unpaidOrders","paidOrders","deletedOrders","doneOrders"])},async mounted(){await this.getAllOrders(),this.getHomeOrders()}},B={class:"container px-3 px-lg-10 mt-8 mt-lg-10 mb-7 mb-lg-10"},A={class:"row"},E={class:"col-12 col-lg-5 mb-9"},I=s("h1",{class:"display-3 fw-bold mb-4 text-start"},"待辦清單",-1),S={class:"d-flex"},k={class:"w-50 bg-white m-2"},$={class:"py-8"},U={class:"d-block fs-2 mb-3 text-primary fw-medium"},N=s("span",{class:"d-block fs-6 mb-3 text-primary"},"全部訂單",-1),V={class:"w-50 bg-white m-2"},L={class:"py-8"},D={class:"d-block fs-2 mb-3 text-primary fw-medium"},M=s("span",{class:"d-block fs-6 mb-3 text-primary"},"待付款訂單",-1),R={class:"col-12 col-lg-7"},G=s("h2",{class:"display-3 fw-bold mb-4 text-start"},"通知",-1),z={class:"d-flex"},F={class:"notice-board w-100 bg-white m-2"},H={class:"p-3"},X={class:"card-body p-3 text-start cursor-pointer"},Y={class:"fs-6 text-dark fw-medium font-notosans mb-3"},q=s("span",{class:"float-end"},[s("i",{class:"bi bi-exclamation-circle-fill text-danger"})],-1),J={class:"fs-7 text-primary"};function Q(t,r,e,d,m,a){return p(),h("div",B,[s("div",A,[s("div",E,[I,s("div",S,[s("div",k,[s("div",$,[s("span",U,c(t.allOrders.length),1),N]),s("button",{type:"button ",class:"custom-btn custom-btn-toGreen w-100",onClick:r[0]||(r[0]=(...o)=>a.toOrderPage&&a.toOrderPage(...o))}," 查看詳情 ")]),s("div",V,[s("div",L,[s("span",D,c(t.unpaidOrders.length),1),M]),s("button",{type:"button ",class:"custom-btn custom-btn-toGreen w-100",onClick:r[1]||(r[1]=(...o)=>a.toOrderPage&&a.toOrderPage(...o))}," 查看詳情 ")])])]),s("div",R,[G,s("button",{type:"button",class:"btn btn-primary my-3",onClick:r[2]||(r[2]=(...o)=>t.lineGetOrder&&t.lineGetOrder(...o))}," 管理員綁定新訂單通知 "),s("div",z,[s("div",F,[s("div",H,[(p(!0),h(T,null,w(m.homeOrderInfo,o=>(p(),h("div",{key:o.id,class:"card border border-primary rounded-3 mb-4",onClick:r[3]||(r[3]=(...O)=>a.toOrderPage&&a.toOrderPage(...O))},[s("div",X,[s("div",Y,[x(" 訂單編號："+c(o.id)+" ",1),q]),s("p",J," 恭喜你！"+c(o.passedTime)+" 收到一筆新訂單喔！ ",1)])]))),128))])])])])])])}const Z=g(v,[["render",Q]]);export{Z as default};
