import{_ as a,A as o,c as n,o as c}from"./index-DPIE8VT_.js";import{Q as l,j as r}from"./index-CwfKsBih.js";const i="https://greensheep-json-server.onrender.com",h={data(){return{user:{},userInfo:{}}},methods:{async checkAccounts(e){try{return(await o.get(`${i}/users/?email=${e}`)).data.length===0}catch(t){console.log(t.response.data)}},async googleAccount(){await this.checkAccounts(this.$route.query.googleEmail)?(alert("此信箱尚未註冊過!"),this.$router.push({name:"MemberSignUp"})):(this.user.email=this.$route.query.googleEmail,this.user.password=`google-${this.user.email}`,this.login())},login(){o.post(`${i}/login`,this.user).then(e=>{this.userInfo.token=e.data.accessToken,this.userInfo.id=e.data.user.id,localStorage.setItem("userInfo",JSON.stringify(this.userInfo)),this.$router.push({name:"MemberLayout"})}).catch(e=>{alert("帳號或密碼錯誤!"),this.$router.push({name:"MemberLogin"})})}},async mounted(){if(Object.keys(this.$route.query).length){this.googleAccount();return}const e=new URLSearchParams(window.location.href.split("?")[1]);this.code=e.get("code"),console.log(this.code);let t=l.stringify({grant_type:"authorization_code",code:this.code,redirect_uri:"http://localhost:5173/greensheep/#/loginLoading",client_id:"2003862374",client_secret:"3f92c0ff3156006f79bca2ab6e993a4e"});try{const s=await o.post("https://api.line.me/oauth2/v2.1/token",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});await this.checkAccounts(r(s.data.id_token).email)?(alert("此信箱尚未註冊過!"),this.$router.push({name:"MemberSignUp"})):(this.user.email=r(s.data.id_token).email,this.user.password=`line-${this.user.email}`,this.login())}catch{alert("請重新登入"),this.$router.push({name:"MemberLogin"})}}},u={class:"d-flex flex-column align-items-center py-50"};function d(e,t,s,g,p,m){return c(),n("div",u,"Loading")}const $=a(h,[["render",d]]);export{$ as default};
