import{_ as g,y as m,c as w,b as e,d as a,w as y,j as n,o as k,u as v}from"./index-C6fsOIa4.js";import{Q as x,j as u}from"./index-WNlcfTen.js";import{S as l}from"./sweetalert2.all-CKAf6HqF.js";import{_ as V}from"./GreenSheep-DGMgQRZ1.js";const h="https://greensheep-json-server.onrender.com",$={data(){return{date:new Date,user:{id:"",nickName:"",email:"",password:"",birthday:"",favorites:[],location:"",phone:""},accountState:"",code:""}},methods:{async checkAccounts(s){try{return(await m.get(`${h}/users/?email=${s}`)).data.length!==0}catch(t){console.log(t.response.data)}},blurFunction(){this.date===null&&(this.date=new Date)},format(){return this.user.birthday=`${this.date.getFullYear()}/${this.date.getMonth()+1}/${this.date.getDate()}`,`您的生日: ${this.user.birthday}`},onSubmit(){this.user.password=`${this.accountState}${this.user.email}`,m.post(`${h}/users`,this.user).then(()=>{l.fire({icon:"warning",title:"註冊成功囉!",showConfirmButton:!1,timer:2e3}),this.$router.push({name:"MemberLogin"})}).catch(s=>{console.log(s)})}},async mounted(){if(Object.keys(this.$route.query).length){if(await this.checkAccounts(this.$route.query.googleEmail.toLowerCase())){l.fire({icon:"warning",title:"此信箱已經註冊過囉!",showConfirmButton:!1,timer:2e3}),this.$router.push({name:"MemberLogin"});return}else if(Object.keys(this.$route.query).length){this.user.email=this.$route.query.googleEmail,this.user.nickName=this.$route.query.googleName,this.accountState="google-";return}}const s=new URLSearchParams(window.location.href.split("?")[1]);this.code=s.get("code");let t=x.stringify({grant_type:"authorization_code",code:this.code,redirect_uri:"https://ritayang0811.github.io/greensheep/#/OtherLogin",client_id:"2003862374",client_secret:"3f92c0ff3156006f79bca2ab6e993a4e"});try{const r=await m.post("https://api.line.me/oauth2/v2.1/token",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});await this.checkAccounts(u(r.data.id_token).email.toLowerCase())?(l.fire({icon:"warning",title:"此信箱已經註冊過囉!",showConfirmButton:!1,timer:2e3}),this.$router.push({name:"MemberLogin"})):(this.user.email=u(r.data.id_token).email,this.user.nickName=u(r.data.id_token).name,this.accountState="line-")}catch{l.fire({icon:"warning",title:"請重新註冊!",showConfirmButton:!1,timer:2e3}),this.$router.push({name:"MemberSignUp"})}}},S={class:"d-flex flex-column align-items-center py-15"},C=e("div",null,[e("h2",{class:"fs-2"},"WELCOME"),e("p",{class:"text-primary"},"Discover Your Unique Elegance")],-1),B={class:"w-50 member-content d-flex flex-column align-items-center py-8"},L=e("h1",{class:"fs-1 mb-8"},"新會員設定",-1),q={class:"mb-3"},D={class:"form-floating mb-3"},N=e("label",{for:"name",class:"z-0"},"暱稱",-1),j={class:"form-floating mb-3"},E=e("label",{for:"email",class:"z-0"},"目前Email",-1),U={class:"mb-3"},M=e("p",{class:"mb-1"},"*生日當月贈送消費金，確認後不可更改",-1),z=e("p",{class:"mb-1 text-start fs-8 text-primary"},"*請選擇您的生日",-1),O=e("button",{type:"submit",class:"d-flex justify-content-center align-items-center btn btn-primary sub-button"},[e("div",{class:"button-img-box me-1"},[e("img",{src:V,alt:"圖像"})]),e("p",null,"完成註冊")],-1);function P(s,t,r,A,o,c){const d=n("v-field"),f=n("error-message"),p=n("VueDatePicker"),_=n("v-form");return k(),w("div",S,[C,e("div",B,[L,e("div",q,[a(_,{ref:"form",class:"member-form",onSubmit:c.onSubmit},{default:y(({errors:b})=>[e("div",D,[a(d,{id:"name",name:"暱稱",type:"text",class:v(["form-control",{"is-invalid":b.暱稱}]),placeholder:"請輸入暱稱",rules:"required",modelValue:o.user.nickName,"onUpdate:modelValue":t[0]||(t[0]=i=>o.user.nickName=i)},null,8,["class","modelValue"]),N,a(f,{name:"暱稱",class:"invalid-feedback text-start"})]),e("div",j,[a(d,{name:"email",type:"email",class:"form-control",id:"email","aria-describedby":"emailHelp",modelValue:o.user.email,"onUpdate:modelValue":t[1]||(t[1]=i=>o.user.email=i),disabled:""},null,8,["modelValue"]),E]),e("div",U,[M,z,a(p,{name:"birthdayDate",modelValue:o.date,"onUpdate:modelValue":t[2]||(t[2]=i=>o.date=i),onBlur:c.blurFunction,format:c.format,locale:"zh-Tw","enable-time-picker":!1,"year-first":"",required:""},null,8,["modelValue","onBlur","format"])]),O]),_:1},8,["onSubmit"])])])])}const Y=g($,[["render",P]]);export{Y as default};
