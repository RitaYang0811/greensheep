import{_ as b,z as c,c as g,e,b as r,w as y,j as n,o as v,x as w}from"./index-vQIT2nmS.js";import{Q as k,j as m}from"./index-C7VIihA5.js";import{_ as x}from"./GreenSheep-DGMgQRZ1.js";const d="https://greensheep-json-server.onrender.com",V={data(){return{date:new Date,user:{id:"",nickName:"",email:"",password:"",birthday:"",favorites:[],location:"",phone:""},accountState:"",code:""}},methods:{async checkAccounts(s){try{return(await c.get(`${d}/users/?email=${s}`)).data.length!==0}catch(t){console.log(t.response.data)}},blurFunction(){this.date===null&&(this.date=new Date)},format(){return this.user.birthday=`${this.date.getFullYear()}/${this.date.getMonth()+1}/${this.date.getDate()}`,`您的生日: ${this.user.birthday}`},onSubmit(){this.user.password=`${this.accountState}${this.user.email}`,c.post(`${d}/users`,this.user).then(s=>{alert("註冊成功囉!"),this.$router.push({name:"MemberLogin"})}).catch(s=>{console.log(s)})}},async mounted(){if(await this.checkAccounts(this.$route.query.googleEmail)){alert("此信箱已經註冊過囉!"),this.$router.push({name:"MemberLogin"});return}else if(Object.keys(this.$route.query).length){this.user.email=this.$route.query.googleEmail,this.user.nickName=this.$route.query.googleName,this.accountState="google-";return}const s=new URLSearchParams(window.location.href.split("?")[1]);this.code=s.get("code");let t=k.stringify({grant_type:"authorization_code",code:this.code,redirect_uri:"http://localhost:5173/greensheep/#/OtherLogin",client_id:"2003862374",client_secret:"3f92c0ff3156006f79bca2ab6e993a4e"});try{const i=await c.post("https://api.line.me/oauth2/v2.1/token",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});await this.checkAccounts(m(i.data.id_token).email)?(alert("此信箱已經註冊過囉!"),this.$router.push({name:"MemberLogin"})):(this.user.email=m(i.data.id_token).email,this.user.nickName=m(i.data.id_token).name,this.accountState="line-")}catch{alert("請重新註冊"),this.$router.push({name:"MemberSignUp"})}}},$={class:"d-flex flex-column align-items-center py-15"},S=e("div",null,[e("h2",{class:"fs-2"},"WELCOME"),e("p",{class:"text-primary"},"Discover Your Unique Elegance")],-1),D={class:"w-50 member-content d-flex flex-column align-items-center py-8"},N=e("h1",{class:"fs-1 mb-8"},"新會員設定",-1),q={class:"mb-3"},E={class:"form-floating mb-3"},L=e("label",{for:"name"},"暱稱",-1),U={class:"form-floating mb-3"},j=e("label",{for:"email"},"目前Email",-1),M={class:"mb-3"},B=e("p",{class:"mb-1"},"*生日當月贈送消費金，確認後不可更改",-1),C=e("p",{class:"mb-1 text-start fs-8 text-primary"},"*請選擇您的生日",-1),z=e("button",{type:"submit",class:"d-flex justify-content-center align-items-center btn btn-primary sub-button"},[e("div",{class:"button-img-box me-1"},[e("img",{src:x,alt:"圖像"})]),e("p",null,"完成註冊")],-1);function O(s,t,i,P,o,l){const u=n("v-field"),h=n("error-message"),p=n("VueDatePicker"),f=n("v-form");return v(),g("div",$,[S,e("div",D,[N,e("div",q,[r(f,{ref:"form",class:"member-form",onSubmit:l.onSubmit},{default:y(({errors:_})=>[e("div",E,[r(u,{id:"name",name:"暱稱",type:"text",class:w(["form-control",{"is-invalid":_.暱稱}]),placeholder:"請輸入暱稱",rules:"required",modelValue:o.user.nickName,"onUpdate:modelValue":t[0]||(t[0]=a=>o.user.nickName=a)},null,8,["class","modelValue"]),L,r(h,{name:"暱稱",class:"invalid-feedback text-start"})]),e("div",U,[r(u,{name:"email",type:"email",class:"form-control",id:"email","aria-describedby":"emailHelp",modelValue:o.user.email,"onUpdate:modelValue":t[1]||(t[1]=a=>o.user.email=a),disabled:""},null,8,["modelValue"]),j]),e("div",M,[B,C,r(p,{name:"birthdayDate",modelValue:o.date,"onUpdate:modelValue":t[2]||(t[2]=a=>o.date=a),onBlur:l.blurFunction,format:l.format,locale:"zh-Tw","enable-time-picker":!1,"year-first":"",required:""},null,8,["modelValue","onBlur","format"])]),z]),_:1},8,["onSubmit"])])])])}const R=b(V,[["render",O]]);export{R as default};
