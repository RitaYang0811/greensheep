import{d as P,z as r}from"./index-CtjhObmR.js";import{d as f}from"./dateToUnix-DUte0kxx.js";import{t as c,a as u}from"./sweetalertToast-Bltzl3rX.js";import{s as b}from"./scrollToTop-BdmBcgwt.js";var _={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"greensheep",BASE_URL:"/greensheep/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:n,VITE_APP_API_NAME:h}=_,v=P("adminArticles",{state:()=>({currentTab:"公開文章",currentPage:1,currentPageArticles:[],articles:[],publicArticles:[],privateArticles:[],pinnedArticles:[],searchArticles:[],article:{title:"",image:"",tag:"",isPublic:!1,author:"",content:""},isNew:!0,isLoading:!1,loadingStatus:{loadingItem:!1,loadingDelete:!1},formStatus:{hasFormImage:!0}}),actions:{async getArticles(){try{this.articles=[],this.publicArticles=[],this.privateArticles=[],this.loadingStatus.loadingItem=!0;let t,e;const s=`${n}/api/${h}/admin/articles`,i=await r.get(s);for(this.articles=i.data.articles,t=i.data.pagination.current_page+1,e=i.data.pagination.total_pages;t<=e;){const a=await r.get(`${s}?page=${t}`);this.articles=[...this.articles,...a.data.articles],t++}this.filterArticles(),this.currentPage=1,this.getCurrentPageArticles(this.currentPage)}catch(t){c(t.response.data.message)}finally{this.loadingStatus.loadingItem=!1}},filterArticles(){const t=[];this.articles.forEach(e=>{e.isPublic?this.publicArticles.push(e):this.privateArticles.push(e),e.isPinned&&t.push(e.id)}),this.publicArticles.sort((e,s)=>{const i=e.isPinned===void 0?0:Number(e.isPinned);return(s.isPinned===void 0?0:Number(s.isPinned))-i}),this.pinnedArticles=t},changeTab(t){this.currentTab=t,this.currentPage=1,this.getCurrentPageArticles(this.currentPage)},getCurrentPageArticles(t,e=""){switch(this.currentTab){case"公開文章":this.searchArticles=this.publicArticles.filter(s=>s.title.match(e)),this.currentPageArticles=this.searchArticles.slice((t-1)*10,t*10);break;case"草稿文章":this.searchArticles=this.privateArticles.filter(s=>s.title.match(e)),this.currentPageArticles=this.searchArticles.slice((t-1)*10,t*10);break}b()},articleActivity(t,e){switch(t){case"delete":this.deleteArticle(e);break;case"new":this.isNew=!0,this.$router.push("/admin/articles/articleCreate");break;case"edit":this.article=[],this.isNew=!1,this.$router.push(`/admin/articles/${e}`);break;default:console.log("default")}},getArticle(t){this.loadingStatus.loadingItem=!0;const e=`${n}/api/${h}/admin/article/${t}`;r.get(e).then(s=>{this.article=s.data.article}).catch(s=>{c(s.response.data.message)}).finally(()=>{this.loadingStatus.loadingItem=!1})},updateArticle(t,e,s){this.isLoading=!0;let i=`${n}/api/${h}/admin/article`,a="post";if(this.isNew||(i=`${n}/api/${h}/admin/article/${t.id}`,a="put"),this.isNew){const{title:l,image:d,tag:g,author:p,content:m}=t,A={title:l,image:d,tag:g,create_at:f("now"),author:p,isPublic:e,content:m};r[a](i,{data:A}).then(o=>{u(o.data.message),this.$router.push("/admin/articles")}).catch(o=>{c(o.response.data.message)}).finally(()=>{this.isLoading=!1})}else s==="public"?t.isPublic=!0:s==="private"&&(t.isPinned=!1,t.isPublic=!1),r[a](i,{data:t}).then(l=>{u(l.data.message),this.$router.push("/admin/articles")}).catch(l=>{c(l.response.data.message)}).finally(()=>{this.isLoading=!1})},deleteArticle(t){this.loadingStatus.loadingDelete=!0;const e=`${n}/api/${h}/admin/article/${t}`;r.delete(e).then(s=>{u(s.data.message),this.getArticles()}).catch(s=>{c(s.response.data.message)}).finally(()=>{this.loadingStatus.loadingDelete=!1})},updateCurrentPage(t){this.currentPage=t}}});export{v as a};
