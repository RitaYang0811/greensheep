import{y as m,z as r}from"./index-BCSXIYdC.js";import{d as f}from"./dateToUnix-DUte0kxx.js";import{t as c,a as h}from"./sweetalertToast-D4HbBDbs.js";const $=m("adminArticles",{state:()=>({currentTab:"公開文章",currentPage:1,currentPageArticles:[],articles:[],publicArticles:[],privateArticles:[],pinnedArticles:[],searchArticles:[],article:{title:"",image:"",tag:"",isPublic:!1,author:"",content:""},isNew:!0,isLoading:!1,loadingStatus:{loadingItem:!1,loadingDelete:!1},formStatus:{hasFormImage:!0}}),actions:{async getArticles(){try{this.articles=[],this.publicArticles=[],this.privateArticles=[],this.loadingStatus.loadingItem=!0;let e,t;const s="https://ec-course-api.hexschool.io/v2/api/greensheep/admin/articles",i=await r.get(s);for(this.articles=i.data.articles,e=i.data.pagination.current_page+1,t=i.data.pagination.total_pages;e<=t;){const a=await r.get(`${s}?page=${e}`);this.articles=[...this.articles,...a.data.articles],e++}this.filterArticles(),this.getCurrentPageArticles(this.currentPage)}catch(e){c(e.response.data.message)}finally{this.loadingStatus.loadingItem=!1}},filterArticles(){const e=[];this.articles.forEach(t=>{t.isPublic?this.publicArticles.push(t):this.privateArticles.push(t),t.isPinned&&e.push(t.id)}),this.publicArticles.sort((t,s)=>{const i=t.isPinned===void 0?0:Number(t.isPinned);return(s.isPinned===void 0?0:Number(s.isPinned))-i}),this.pinnedArticles=e},changeTab(e){this.currentTab=e,this.currentPage=1,this.getCurrentPageArticles(this.currentPage)},getCurrentPageArticles(e,t=""){switch(this.currentTab){case"公開文章":this.searchArticles=this.publicArticles.filter(s=>s.title.match(t)),this.currentPageArticles=this.searchArticles.slice((e-1)*10,e*10);break;case"草稿文章":this.searchArticles=this.privateArticles.filter(s=>s.title.match(t)),this.currentPageArticles=this.searchArticles.slice((e-1)*10,e*10);break}},articleActivity(e,t){switch(e){case"delete":this.deleteArticle(t);break;case"new":this.article={title:"",image:"",tag:"",isPublic:!1,author:"",content:""},this.isNew=!0,this.$router.push("/admin/articles/articleCreate");break;case"edit":this.article=[],this.isNew=!1,this.$router.push(`/admin/articles/${t}`);break;default:console.log("default")}},getArticle(e){this.loadingStatus.loadingItem=!0;const t=`https://ec-course-api.hexschool.io/v2/api/greensheep/admin/article/${e}`;r.get(t).then(s=>{this.article=s.data.article}).catch(s=>{c(s.response.data.message)}).finally(()=>{this.loadingStatus.loadingItem=!1})},updateArticle(e,t,s){this.isLoading=!0;let i="https://ec-course-api.hexschool.io/v2/api/greensheep/admin/article",a="post";if(this.isNew||(i=`https://ec-course-api.hexschool.io/v2/api/greensheep/admin/article/${e.id}`,a="put"),this.isNew){const{title:l,image:o,tag:u,author:g,content:d}=e,p={title:l,image:o,tag:u,create_at:f("now"),author:g,isPublic:t,content:d};r[a](i,{data:p}).then(n=>{h(n.data.message),this.$router.push("/admin/articles")}).catch(n=>{c(n.response.data.message)}).finally(()=>{this.isLoading=!1})}else s==="public"?e.isPublic=!0:s==="private"&&(e.isPinned=!1,e.isPublic=!1),r[a](i,{data:e}).then(l=>{h(l.data.message),this.$router.push("/admin/articles")}).catch(l=>{c(l.response.data.message)}).finally(()=>{this.isLoading=!1})},deleteArticle(e){this.loadingStatus.loadingDelete=!0;const t=`https://ec-course-api.hexschool.io/v2/api/greensheep/admin/article/${e}`;r.delete(t).then(s=>{h(s.data.message),this.getArticles()}).catch(s=>{c(s.response.data.message)}).finally(()=>{this.loadingStatus.loadingDelete=!1})},updateCurrentPage(e){this.currentPage=e}},getters:{}});export{$ as a};
