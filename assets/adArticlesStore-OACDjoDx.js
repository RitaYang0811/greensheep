import{y as P,C as r}from"./index-A6H3Xhxj.js";import{d as f}from"./dateToUnix-w32YPp53.js";import{t as l,a as u}from"./sweetalertToast-3M2ebxo3.js";import{s as _}from"./scrollToTop-A6ITVMuW.js";var b={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"greensheep",VITE_LINE_CLIENT_ID:"x9iTcS6m9Fdlz8XFfAbkqs",VITE_LINE_CLIENT_SECRET:"iGiOLRLmU2aNTDuObVQlcP5XzPYSbUzJ9gvUl4YvPzx",BASE_URL:"/greensheep/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:n,VITE_APP_API_NAME:h}=b,T=P("adminArticles",{state:()=>({currentTab:"公開文章",currentPage:1,currentPageArticles:[],articles:[],publicArticles:[],privateArticles:[],pinnedArticles:[],searchArticles:[],article:{title:"",image:"",tag:"",isPublic:!1,author:"",content:""},isNew:!0,isLoading:!1,loadingStatus:{loadingItem:!1,loadingDelete:!1},formStatus:{hasFormImage:!0}}),actions:{async getArticles(){try{this.articles=[],this.publicArticles=[],this.privateArticles=[],this.loadingStatus.loadingItem=!0;let t,e;const i=`${n}/api/${h}/admin/articles`,s=await r.get(i);for(this.articles=s.data.articles,t=s.data.pagination.current_page+1,e=s.data.pagination.total_pages;t<=e;){const a=await r.get(`${i}?page=${t}`);this.articles=[...this.articles,...a.data.articles],t++}this.filterArticles(),this.currentPage=1,this.getCurrentPageArticles(this.currentPage)}catch(t){l(t.response.data.message)}finally{this.loadingStatus.loadingItem=!1}},filterArticles(){const t=[];this.articles.forEach(e=>{e.isPublic?this.publicArticles.push(e):this.privateArticles.push(e),e.isPinned&&t.push(e.id)}),this.publicArticles.sort((e,i)=>{const s=e.isPinned===void 0?0:Number(e.isPinned);return(i.isPinned===void 0?0:Number(i.isPinned))-s}),this.pinnedArticles=t},changeTab(t){this.currentTab=t,this.currentPage=1,this.getCurrentPageArticles(this.currentPage)},getCurrentPageArticles(t,e=""){switch(this.currentTab){case"公開文章":this.searchArticles=this.publicArticles.filter(i=>i.title.match(e)),this.currentPageArticles=this.searchArticles.slice((t-1)*10,t*10);break;case"草稿文章":this.searchArticles=this.privateArticles.filter(i=>i.title.match(e)),this.currentPageArticles=this.searchArticles.slice((t-1)*10,t*10);break}_()},articleActivity(t,e){switch(t){case"delete":this.deleteArticle(e);break;case"new":this.isNew=!0,this.$router.push("/admin/articles/articleCreate");break;case"edit":this.article=[],this.isNew=!1,this.$router.push(`/admin/articles/${e}`);break;default:l("操作錯誤")}},getArticle(t){this.loadingStatus.loadingItem=!0;const e=`${n}/api/${h}/admin/article/${t}`;r.get(e).then(i=>{this.article=i.data.article}).catch(i=>{l(i.response.data.message)}).finally(()=>{this.loadingStatus.loadingItem=!1})},updateArticle(t,e,i){this.isLoading=!0;let s=`${n}/api/${h}/admin/article`,a="post";if(this.isNew||(s=`${n}/api/${h}/admin/article/${t.id}`,a="put"),this.isNew){const{title:c,image:d,tag:g,author:m,content:p}=t,A={title:c,image:d,tag:g,create_at:f("now"),author:m,isPublic:e,content:p};r[a](s,{data:A}).then(o=>{u(o.data.message),this.$router.push("/admin/articles")}).catch(o=>{l(o.response.data.message)}).finally(()=>{this.isLoading=!1})}else i==="public"?t.isPublic=!0:i==="private"&&(t.isPinned=!1,t.isPublic=!1),r[a](s,{data:t}).then(c=>{u(c.data.message),this.$router.push("/admin/articles")}).catch(c=>{l(c.response.data.message)}).finally(()=>{this.isLoading=!1})},deleteArticle(t){this.loadingStatus.loadingDelete=!0;const e=`${n}/api/${h}/admin/article/${t}`;r.delete(e).then(i=>{u(i.data.message),this.getArticles()}).catch(i=>{l(i.response.data.message)}).finally(()=>{this.loadingStatus.loadingDelete=!1})},updateCurrentPage(t){this.currentPage=t}}});export{T as a};
